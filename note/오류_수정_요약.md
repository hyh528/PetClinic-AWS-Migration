# Terraform 오류 수정 요약

이 문서는 Terraform 환경 설정 및 코드 작성 중 발생했던 주요 오류들과 그 해결 과정을 요약합니다.

## 1. `api_gateway.tf`의 `cloudwatch_role_arn` 오류

*   **문제**: `terraform/envs/dev/application/api_gateway.tf` 파일에서 `api_gateway` 모듈을 호출할 때, 모듈이 지원하지 않는 `cloudwatch_role_arn` 인자를 사용하려고 시도했습니다. 이 인자는 주석 처리되어 있었지만, Terraform이 여전히 이를 파싱하려고 시도하여 오류가 발생했습니다.
*   **해결**: `api_gateway.tf` 파일에서 `cloudwatch_role_arn` 참조 라인을 완전히 제거했습니다.

## 2. `data.tf`의 선언되지 않은 입력 변수 오류 (`tf_lock_table_name`, `encrypt_state`)

*   **문제**: `terraform/envs/dev/application/data.tf` 파일에서 `var.tf_lock_table_name`과 `var.encrypt_state` 변수를 사용했지만, 이 변수들이 `terraform/envs/dev/application/variables.tf` 파일에 선언되어 있지 않아 오류가 발생했습니다.
*   **해결**: `tf_lock_table_name` (string 타입, 기본값 `petclinic-tf-locks-jungsu-kopo`)과 `encrypt_state` (bool 타입, 기본값 `true`) 변수를 `terraform/envs/dev/application/variables.tf` 파일에 추가했습니다.

## 3. `api_gateway.tf`의 `alb_dns_name` 속성 오류

*   **문제**: `terraform/envs/dev/application/api_gateway.tf` 파일에서 `alb_dns_name`을 `data.terraform_remote_state.network.outputs.alb_dns_name`을 통해 `network` 레이어의 원격 상태에서 가져오려고 했지만, ALB는 `application` 레이어에서 생성되므로 `network` 레이어의 출력에 해당 속성이 존재하지 않았습니다.
*   **해결**: `terraform/envs/dev/application/api_gateway.tf` 파일에서 `alb_dns_name` 참조를 `aws_lb.main.dns_name`으로 변경하여 `application` 레이어 내에서 생성된 ALB 리소스의 DNS 이름을 직접 참조하도록 수정했습니다.

## 4. `ecs.tf`의 `db_password_secret_arn` 속성 및 필수 인자 누락 오류

*   **문제**: `terraform/envs/dev/application/ecs.tf` 파일에서 `data.terraform_remote_state.security.outputs.db_password_secret_arn`을 참조했지만, `security` 레이어의 원격 상태에서 `db_password_secret_arn` 출력을 찾을 수 없다는 오류가 발생했습니다. 이로 인해 `ecs` 모듈에 필수 인자가 전달되지 않아 추가 오류가 발생했습니다. `db_password_secret_arn`은 `terraform/envs/dev/security/outputs.tf`에 선언되어 있었지만, 실제 `tfstate` 파일에 값이 없거나 `application` 레이어가 최신 상태를 읽어오지 못하는 것이 원인이었습니다.
*   **해결**:
    1.  `terraform/envs/dev/security` 디렉토리로 이동하여 `terraform init` 및 `terraform apply -var-file=dev.tfvars`를 실행하여 `security` 레이어의 `tfstate`를 최신 상태로 업데이트해야 합니다.
    2.  이후 `terraform/envs/dev/application` 디렉토리로 돌아와 `terraform init -reconfigure`를 실행하여 `security` 레이어의 최신 원격 상태 데이터를 새로고침해야 합니다.

## 5. `ecs` 모듈의 `db_master_user_secret_arn` 변수 이름 불일치

*   **문제**: `terraform/envs/dev/application/ecs.tf` 파일에서 `ecs` 모듈을 호출할 때 `db_password_secret_arn` 인자 이름을 `db_master_user_secret_arn`으로 변경했지만, `terraform/modules/ecs/variables.tf` 파일 내의 모듈 변수 이름은 여전히 `db_password_secret_arn`으로 되어 있어 불일치가 발생했습니다.
*   **해결**: `terraform/modules/ecs/variables.tf` 파일에서 `db_password_secret_arn` 변수 이름을 `db_master_user_secret_arn`으로 변경하여 호출부와 모듈 내부의 변수 이름을 일치시켰습니다.

이 요약본은 현재까지 발생한 주요 Terraform 오류와 그 해결 과정을 담고 있습니다. 4번 항목의 해결을 위해 `security` 레이어의 `terraform apply` 실행이 필요합니다.