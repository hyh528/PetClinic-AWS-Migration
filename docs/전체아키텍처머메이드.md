# Spring PetClinic AWS Architecture Diagram

## ì „ì²´ ì•„í‚¤í…ì²˜ ê°œìš” (us-west-2)

```mermaid
graph TB
    %% ì™¸ë¶€ ì‚¬ìš©ì
    User([ğŸ‘¤ Users])
    
    %% CloudFront & S3 (Frontend)
    CF[â˜ï¸ CloudFront Distribution]
    S3[ğŸ“¦ S3 Bucket<br/>Frontend Static Files]
    
    %% Internet Gateway
    IGW[ğŸŒ Internet Gateway]
    
    %% API Gateway
    APIGW[ğŸšª API Gateway<br/>REST API<br/>Replaces: Spring Cloud Gateway]
    
    %% VPC
    subgraph VPC["ğŸ¢ VPC (10.0.0.0/16)"]
        
        %% Public Subnet Zone
        subgraph Public["ğŸŒ Public Subnets (Multi-AZ)"]
            ALB[âš–ï¸ Application Load Balancer<br/>Port 80/443]
            NAT_A[ğŸ”„ NAT Gateway<br/>AZ-a]
            NAT_B[ğŸ”„ NAT Gateway<br/>AZ-b]
        end
        
        %% Private App Subnet Zone
        subgraph PrivateApp["ğŸ”’ Private App Subnets (Multi-AZ)"]
            
            subgraph ECS["ğŸ“¦ ECS Fargate Cluster"]
                CUSTOMERS[ğŸ• customers-service<br/>CPU: 256, Mem: 512]
                VETS[ğŸ‘¨â€âš•ï¸ vets-service<br/>CPU: 256, Mem: 512]
                VISITS[ğŸ“… visits-service<br/>CPU: 256, Mem: 512]
                ADMIN[ğŸ› ï¸ admin-server<br/>CPU: 256, Mem: 512<br/>Monitoring]
            end
            
            LAMBDA[âš¡ Lambda Function<br/>GenAI Service<br/>Python 3.11<br/>Replaces: GenAI ECS]
            
            VPCE[ğŸ”Œ VPC Endpoints<br/>ECR, Logs, SSM<br/>Secrets, KMS, X-Ray]
        end
        
        %% Private DB Subnet Zone
        subgraph PrivateDB["ğŸ—„ï¸ Private DB Subnets (Multi-AZ)"]
            AURORA_W[(ğŸ’¾ Aurora MySQL<br/>Writer Instance<br/>Serverless v2<br/>ACU: 0.5-1.0)]
            AURORA_R[(ğŸ’¾ Aurora MySQL<br/>Reader Instance<br/>Serverless v2<br/>Read Replica)]
        end
    end
    
    %% AWS Managed Services
    subgraph AWS["â˜ï¸ AWS Managed Services"]
        PARAM[âš™ï¸ Systems Manager<br/>Parameter Store<br/>Replaces: Config Server]
        CLOUDMAP[ğŸ—ºï¸ AWS Cloud Map<br/>Service Discovery<br/>Replaces: Eureka]
        BEDROCK[ğŸ¤– Amazon Bedrock<br/>Claude 3 Haiku<br/>AI/ML Service]
        SECRETS[ğŸ” Secrets Manager<br/>DB Credentials]
        CW[ğŸ“Š CloudWatch + X-Ray<br/>Monitoring & Tracing]
        ECR[ğŸ“¦ Amazon ECR<br/>Container Registry]
    end
    
    %% User Flow
    User -->|HTTPS| CF
    CF --> S3
    User -->|API Requests| APIGW
    
    %% API Gateway Routing
    APIGW -->|/api/customers<br/>/api/vets<br/>/api/visits<br/>/admin| ALB
    APIGW -->|/api/genai| LAMBDA
    
    %% Internet Gateway
    IGW --> ALB
    
    %% Load Balancer to Services
    ALB -->|Path Routing| CUSTOMERS
    ALB -->|Path Routing| VETS
    ALB -->|Path Routing| VISITS
    ALB -->|Path Routing| ADMIN
    
    %% ECS Services to Database
    CUSTOMERS -->|MySQL 3306| AURORA_W
    VETS -->|MySQL 3306| AURORA_W
    VISITS -->|MySQL 3306| AURORA_W
    
    %% Lambda to Services
    LAMBDA -->|Bedrock API| BEDROCK
    LAMBDA -->|MySQL 3306| AURORA_W
    
    %% Aurora Replication
    AURORA_W -.->|Replication| AURORA_R
    
    %% ECS to AWS Services
    CUSTOMERS -.->|Config| PARAM
    VETS -.->|Config| PARAM
    VISITS -.->|Config| PARAM
    ADMIN -.->|Config| PARAM
    
    CUSTOMERS -.->|Discovery| CLOUDMAP
    VETS -.->|Discovery| CLOUDMAP
    VISITS -.->|Discovery| CLOUDMAP
    ADMIN -.->|Discovery| CLOUDMAP
    
    CUSTOMERS -.->|Secrets| SECRETS
    VETS -.->|Secrets| SECRETS
    VISITS -.->|Secrets| SECRETS
    LAMBDA -.->|Secrets| SECRETS
    
    %% Monitoring
    CUSTOMERS -.->|Logs & Metrics| CW
    VETS -.->|Logs & Metrics| CW
    VISITS -.->|Logs & Metrics| CW
    ADMIN -.->|Logs & Metrics| CW
    LAMBDA -.->|Logs & Metrics| CW
    ALB -.->|Metrics| CW
    AURORA_W -.->|Metrics| CW
    
    %% VPC Endpoints
    ECS -.->|Private Link| VPCE
    LAMBDA -.->|Private Link| VPCE
    
    %% Container Images
    ECS -.->|Pull Images| ECR
    
    %% NAT Gateway for outbound
    ECS -.->|Outbound| NAT_A
    ECS -.->|Outbound| NAT_B
    LAMBDA -.->|Outbound| NAT_A

    %% Styling
    classDef frontend fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef compute fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    classDef database fill:#e8eaf6,stroke:#3f51b5,stroke-width:2px
    classDef network fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
    classDef managed fill:#e8f5e9,stroke:#4caf50,stroke-width:2px
    classDef lambda fill:#ffe0b2,stroke:#ff6f00,stroke-width:2px
    
    class CF,S3 frontend
    class CUSTOMERS,VETS,VISITS,ADMIN compute
    class AURORA_W,AURORA_R database
    class ALB,IGW,NAT_A,NAT_B network
    class PARAM,CLOUDMAP,BEDROCK,SECRETS,CW,ECR,APIGW managed
    class LAMBDA lambda
```

## ì£¼ìš” êµ¬ì„± ìš”ì†Œ

### 1. Frontend Layer
- **CloudFront + S3**: ì •ì  ì›¹ì‚¬ì´íŠ¸ í˜¸ìŠ¤íŒ… (CDN ê¸€ë¡œë²Œ ë°°í¬)

### 2. API Gateway Layer
- **API Gateway**: ë‹¨ì¼ ì§„ì…ì , ê²½ë¡œ ê¸°ë°˜ ë¼ìš°íŒ…
  - `/api/*` â†’ ALB â†’ ECS Services
  - `/api/genai/*` â†’ Lambda Function
  - **ëŒ€ì²´**: Spring Cloud Gateway

### 3. Network Layer (VPC: 10.0.0.0/16)
- **Public Subnets** (10.0.1.0/24, 10.0.2.0/24)
  - Application Load Balancer
  - NAT Gateways (ê° AZ)
  
- **Private App Subnets** (10.0.3.0/24, 10.0.4.0/24)
  - ECS Fargate Services
  - Lambda Functions
  - VPC Endpoints
  
- **Private DB Subnets** (10.0.5.0/24, 10.0.6.0/24)
  - Aurora MySQL Cluster (Multi-AZ)

### 4. Compute Layer
- **ECS Fargate Cluster**
  - `customers-service`: ê³ ê° ë° ë°˜ë ¤ë™ë¬¼ ê´€ë¦¬
  - `vets-service`: ìˆ˜ì˜ì‚¬ ì •ë³´ ê´€ë¦¬
  - `visits-service`: ë°©ë¬¸ ë° ì˜ˆì•½ ê´€ë¦¬
  - `admin-server`: ëª¨ë‹ˆí„°ë§ (í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼)
  
- **Lambda Function**
  - GenAI Service (Python 3.11)
  - Amazon Bedrock í†µí•©
  - **ëŒ€ì²´**: GenAI ECS Service

### 5. Database Layer
- **Aurora MySQL Serverless v2**
  - Writer Instance (Primary)
  - Reader Instance (Read Replica)
  - ACU Range: 0.5 - 1.0
  - Multi-AZ ê³ ê°€ìš©ì„±

### 6. AWS Managed Services

#### Configuration Management
- **Systems Manager Parameter Store**
  - ê³„ì¸µì  ì„¤ì • ê´€ë¦¬ (`/petclinic/dev/*`)
  - **ëŒ€ì²´**: Spring Cloud Config Server

#### Service Discovery
- **AWS Cloud Map**
  - DNS ê¸°ë°˜ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬
  - ECS ë„¤ì´í‹°ë¸Œ í†µí•©
  - **ëŒ€ì²´**: Netflix Eureka

#### AI/ML Service
- **Amazon Bedrock**
  - Claude 3 Haiku ëª¨ë¸
  - Lambda í†µí•©

#### Security & Secrets
- **AWS Secrets Manager**
  - DB ìê²©ì¦ëª… ìë™ ê´€ë¦¬
  - ìë™ ë¡œí…Œì´ì…˜ (30ì¼)

#### Monitoring & Observability
- **CloudWatch**
  - ë¡œê·¸ ì¤‘ì•™ ì§‘ì¤‘í™”
  - ë©”íŠ¸ë¦­ ë° ì•ŒëŒ
  - Container Insights
  
- **AWS X-Ray**
  - ë¶„ì‚° ì¶”ì 
  - ì„œë¹„ìŠ¤ ë§µ

#### Container Registry
- **Amazon ECR**
  - Docker ì´ë¯¸ì§€ ì €ì¥ì†Œ
  - ê° ì„œë¹„ìŠ¤ë³„ ë¦¬í¬ì§€í† ë¦¬

## Network Flow

### Inbound Traffic Flow
```
User â†’ CloudFront â†’ S3 (Static Files)
User â†’ API Gateway â†’ ALB â†’ ECS Services
User â†’ API Gateway â†’ Lambda â†’ Bedrock
```

### Service-to-Service Communication
```
ECS Services â†’ Cloud Map (Service Discovery)
ECS Services â†’ Parameter Store (Configuration)
ECS Services â†’ Secrets Manager (Credentials)
ECS Services â†’ Aurora (Database)
```

### Outbound Traffic Flow
```
ECS Services â†’ NAT Gateway â†’ Internet (Updates, API calls)
Lambda â†’ NAT Gateway â†’ Internet (Bedrock API)
ECS/Lambda â†’ VPC Endpoints â†’ AWS Services (Private)
```

## Security Architecture

### Network Security
- **Security Groups**: ìµœì†Œ ê¶Œí•œ ì›ì¹™
  - ALB SG: 80, 443 í—ˆìš©
  - ECS SG: ALBì—ì„œë§Œ 8080, 9090 í—ˆìš©
  - Aurora SG: ECS/Lambdaì—ì„œë§Œ 3306 í—ˆìš©
  
- **Network ACLs**: Subnet ë ˆë²¨ ë°©í™”ë²½
- **VPC Endpoints**: Private Linkë¥¼ í†µí•œ AWS ì„œë¹„ìŠ¤ ì ‘ê·¼

### Access Control
- **IAM Roles**: ECS Task Execution Role, Lambda Execution Role
- **IAM Policies**: ìµœì†Œ ê¶Œí•œ ë¶€ì—¬
- **Secrets Manager**: ìê²©ì¦ëª… ì•”í˜¸í™” ì €ì¥

### Data Protection
- **ì „ì†¡ ì¤‘ ì•”í˜¸í™”**: HTTPS/TLS (ALB, API Gateway)
- **ì €ì¥ ì‹œ ì•”í˜¸í™”**: Aurora (KMS), S3, Secrets Manager

## High Availability & Disaster Recovery

### Multi-AZ Deployment
- **Compute**: ECS tasks across 2 AZs
- **Database**: Aurora Multi-AZ (Writer + Reader)
- **Network**: NAT Gateway per AZ

### Auto Scaling
- **ECS Services**: CPU 70% ê¸°ì¤€ ìë™ í™•ì¥ (1-4 tasks)
- **Aurora**: Serverless v2 ìë™ ACU ì¡°ì • (0.5-1.0)

### Backup & Recovery
- **Aurora**: ìë™ ë°±ì—… (7ì¼ ë³´ê´€)
- **Point-in-Time Recovery**: ìµœê·¼ 5ë¶„ê¹Œì§€ ë³µêµ¬ ê°€ëŠ¥

## Cost Optimization

### Serverless Architecture
- **Lambda**: ì‹¤í–‰ ì‹œê°„ë§Œí¼ë§Œ ê³¼ê¸ˆ
- **Aurora Serverless v2**: ì‚¬ìš©ëŸ‰ ê¸°ë°˜ ACU ê³¼ê¸ˆ
- **API Gateway**: ìš”ì²­ë‹¹ ê³¼ê¸ˆ

### Managed Services
- **ìš´ì˜ ë¹„ìš© ì ˆê°**: ì„œë²„ ê´€ë¦¬ ë¶ˆí•„ìš”
- **ìë™ ìŠ¤ì¼€ì¼ë§**: ìœ íœ´ ë¦¬ì†ŒìŠ¤ ìµœì†Œí™”

### Expected Monthly Cost
- ECS Fargate: $20-40
- Aurora Serverless v2: $40-80
- API Gateway: $5-15
- Lambda: $5-20
- Other Services: $30-50
- **Total**: ~$130-250/month

## Monitoring Strategy

### CloudWatch Monitoring
- **Container Insights**: ECS í´ëŸ¬ìŠ¤í„° ìƒì„¸ ë©”íŠ¸ë¦­
- **Log Groups**: ì„œë¹„ìŠ¤ë³„ ë¡œê·¸ ë¶„ë¦¬
- **Alarms**: CPU, Memory, Error Rate ëª¨ë‹ˆí„°ë§

### X-Ray Tracing
- **Service Map**: ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ê°„ í˜¸ì¶œ ì¶”ì 
- **Performance**: ë ˆì´í„´ì‹œ ë° ë³‘ëª© ì§€ì  ë¶„ì„

### Admin Server (Hybrid)
- **Development/Debug**: ì‹¤ì‹œê°„ ë¡œê·¸ ë ˆë²¨ ë³€ê²½
- **Actuator Integration**: Spring Boot ë©”íŠ¸ë¦­ í†µí•© UI

## Terraform Layer Architecture

### Infrastructure as Code (12 Layers)
1. **01-network**: VPC, Subnets, Gateways, VPC Endpoints
2. **02-security**: Security Groups, IAM Roles, NACLs
3. **03-database**: Aurora MySQL Cluster, Secrets Manager
4. **04-parameter-store**: Application Configuration
5. **05-cloud-map**: Service Discovery
6. **06-lambda-genai**: AI Service (Lambda + Bedrock)
7. **07-application**: ECS Cluster, Services, ALB, ECR
8. **08-api-gateway**: API Gateway Configuration
9. **09-aws-native**: AWS Services Integration
10. **10-monitoring**: CloudWatch Dashboards, Alarms
11. **11-frontend**: S3 + CloudFront
12. **12-notification**: Slack Notifications

### Deployment Workflow
```bash
# ìˆœì°¨ì  ë ˆì´ì–´ ë°°í¬
terraform apply -target=module.01-network
terraform apply -target=module.02-security
terraform apply -target=module.03-database
# ... ë‚˜ë¨¸ì§€ ë ˆì´ì–´
```

## Well-Architected Framework Alignment

### âœ… Operational Excellence
- Infrastructure as Code (Terraform)
- CI/CD Automation (GitHub Actions)
- Centralized Monitoring (CloudWatch)

### âœ… Security
- Network Isolation (VPC, Subnets)
- Least Privilege (IAM)
- Encryption (Transit & At-Rest)

### âœ… Reliability
- Multi-AZ Deployment
- Auto Scaling
- Automatic Failover

### âœ… Performance Efficiency
- Serverless Computing (Fargate, Lambda)
- Load Balancing (ALB)
- Monitoring-based Optimization

### âœ… Cost Optimization
- Managed Services
- Usage-based Pricing
- Auto Scaling

### âœ… Sustainability
- Resource Efficiency (Serverless)
- Minimal Idle Resources

---

**Architecture Version**: 1.0  
**Last Updated**: 2025-11-13  
**Region**: us-west-2 (Oregon)  
**Environment**: Development