<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring PetClinic AWS Architecture Diagram</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #232f3e;
            text-align: center;
            margin-bottom: 30px;
        }
        .mermaid {
            text-align: center;
        }
        .description {
            margin-top: 30px;
            line-height: 1.6;
        }
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .feature-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #ff9900;
        }
        .feature-item h3 {
            margin-top: 0;
            color: #232f3e;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Spring PetClinic Microservices - Complete AWS Architecture (To-Be)</h1>

        <h2>Architecture Overview</h2>
        <div class="mermaid">
            graph TB
                subgraph "Internet"
                    User[ÏÇ¨Ïö©Ïûê]
                end

                subgraph "AWS Cloud (us-west-2)"
                    subgraph "VPC (10.0.0.0/16)"
                        IGW[Internet Gateway]

                        subgraph "Public Subnet (AZ-a: 10.0.1.0/24, AZ-b: 10.0.2.0/24)"
                            ALB[Application Load Balancer]
                            API[Amazon API Gateway]
                            NAT[NAT Gateway]
                        end

                        subgraph "Private App Subnet (AZ-a: 10.0.3.0/24, AZ-b: 10.0.4.0/24)"
                            ECS[ECS Fargate Cluster]

                            subgraph "ECS Services"
                                CS[customers-service]
                                VS[visits-service]
                                VETS[vets-service]
                                AS["admin-server<br/>(ÌïòÏù¥Î∏åÎ¶¨Îìú Î™®ÎãàÌÑ∞ÎßÅ)"]
                            end

                            Lambda[Lambda GenAI Function]
                        end

                        subgraph "Private DB Subnet (AZ-a: 10.0.5.0/24, AZ-b: 10.0.6.0/24)"
                            AURORA[("Aurora MySQL ÌÅ¥Îü¨Ïä§ÌÑ∞<br/>Writer + Reader<br/>Serverless v2")]
                        end
                    end

                    subgraph "AWS Managed Services"
                        ECR[Amazon ECR]
                        CW[Amazon CloudWatch]
                        XRay[AWS X-Ray]
                        SSM["Systems Manager<br/>Parameter Store"]
                        SECRETS[Secrets Manager]
                        CLOUDMAP["AWS Cloud Map<br/>Service Discovery"]
                        BEDROCK[Amazon Bedrock]
                        VPCE["VPC Endpoints<br/>ECR, Logs, SSM, etc."]
                        S3[S3 Frontend Hosting]
                        CF[CloudFront Distribution]
                    end
                end

                %% ÏÇ¨Ïö©Ïûê ÏöîÏ≤≠ ÌùêÎ¶Ñ
                User --> CF
                CF --> S3
                User --> API
                API --> ALB
                API --> Lambda

                %% ALBÏóêÏÑú ECS ÏÑúÎπÑÏä§Î°ú ÎùºÏö∞ÌåÖ
                ALB --> CS
                ALB --> VS
                ALB --> VETS
                ALB --> AS

                %% ECS ÏÑúÎπÑÏä§ÏóêÏÑú Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïó∞Í≤∞
                CS --> AURORA
                VS --> AURORA
                VETS --> AURORA

                %% LambdaÏóêÏÑú Bedrock Î∞è Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïó∞Í≤∞
                Lambda --> BEDROCK
                Lambda --> AURORA

                %% Î™®ÎãàÌÑ∞ÎßÅ Ïó∞Í≤∞
                ECS -.-> CW
                ECS -.-> XRay
                Lambda -.-> CW
                ALB -.-> CW
                API -.-> CW

                %% Parameter Store Ïó∞Í≤∞ (ECS ÏÑúÎπÑÏä§Îßå)
                CS -.-> SSM
                VS -.-> SSM
                VETS -.-> SSM
                AS -.-> SSM

                %% Secrets Manager Ïó∞Í≤∞
                CS -.-> SECRETS
                VS -.-> SECRETS
                Lambda -.-> SECRETS

                %% Cloud Map ÏÑúÎπÑÏä§ ÎîîÏä§Ïª§Î≤ÑÎ¶¨ (ECS ÏÑúÎπÑÏä§Îßå)
                CS -.-> CLOUDMAP
                VS -.-> CLOUDMAP
                VETS -.-> CLOUDMAP
                AS -.-> CLOUDMAP

                %% VPC ÏóîÎìúÌè¨Ïù∏Ìä∏ Ïó∞Í≤∞
                ECS -.-> VPCE
                Lambda -.-> VPCE
        </div>

        <h2>Data Flow Diagram</h2>
        <div class="mermaid">
            flowchart TD
                A[üë§ User Request] --> B{Request Type}
                B -->|Static Content| C[üåê CloudFront CDN]
                B -->|API Call| D[üö™ Amazon API Gateway]

                C --> E[üì¶ S3 Bucket]
                E --> F[‚úÖ Response: HTML/CSS/JS]

                D --> G{API Path}
                G -->|/api/customers/*| H[‚öñÔ∏è ALB ‚Üí customers-service]
                G -->|/api/vets/*| I[‚öñÔ∏è ALB ‚Üí vets-service]
                G -->|/api/visits/*| J[‚öñÔ∏è ALB ‚Üí visits-service]
                G -->|/admin/*| K[‚öñÔ∏è ALB ‚Üí admin-server]
                G -->|GenAI| L[‚ö° Lambda GenAI Function]

                H --> M[üîç Cloud Map DNS Resolution]
                I --> M
                J --> M
                K --> M

                M --> N[üê≥ ECS Service Discovery]
                N --> O[üóÑÔ∏è Aurora MySQL Database]

                L --> P[ü§ñ Amazon Bedrock AI Models]
                L --> O

                O --> Q[üìä Query Results]
                P --> R[ü§ñ AI Response]

                H --> S[üìà CloudWatch Logs]
                I --> S
                J --> S
                K --> S
                L --> S

                Q --> T[üìã Response to User]
                R --> T
                F --> T

                S --> U[üìä CloudWatch Metrics]
                U --> V[üö® Alarms & Monitoring]
        </div>

        <h2>Sequence Diagram - API Request Flow</h2>
        <div class="mermaid">
            sequenceDiagram
                participant U as User
                participant CF as CloudFront
                participant API as API Gateway
                participant ALB as Application LB
                participant CS as customers-service
                participant CM as Cloud Map
                participant DB as Aurora MySQL
                participant CW as CloudWatch

                U->>CF: GET /api/customers
                CF->>API: Forward request
                API->>ALB: Route to ECS
                ALB->>CS: Forward to service

                CS->>CM: Resolve service DNS
                CM-->>CS: Return IP addresses

                CS->>DB: Execute query
                DB-->>CS: Return data

                CS-->>ALB: Send response
                ALB-->>API: Forward response
                API-->>CF: Send response
                CF-->>U: Return data

                CS->>CW: Log request metrics
                ALB->>CW: Log load balancer metrics
                API->>CW: Log API metrics
        </div>

        <h2>Sequence Diagram - AI Chat Flow</h2>
        <div class="mermaid">
            sequenceDiagram
                participant U as User
                participant FE as Frontend
                participant API as API Gateway
                participant Lambda as Lambda GenAI
                participant Bedrock as Amazon Bedrock
                participant DB as Aurora MySQL
                participant CW as CloudWatch

                U->>FE: Send chat message
                FE->>API: POST /api/genai/chat
                API->>Lambda: Invoke function

                Lambda->>Bedrock: Send prompt to Claude
                Bedrock-->>Lambda: Stream AI response

                Lambda->>DB: Store conversation
                DB-->>Lambda: Confirm storage

                Lambda-->>API: Return AI response
                API-->>FE: Stream response
                FE-->>U: Display AI chat

                Lambda->>CW: Log usage metrics
                Bedrock->>CW: Log token usage
        </div>

        <h2>Sequence Diagram - Service Discovery Flow</h2>
        <div class="mermaid">
            sequenceDiagram
                participant CS as customers-service
                participant CM as AWS Cloud Map
                participant DNS as Route 53 DNS
                participant VS as visits-service
                participant CW as CloudWatch

                CS->>CM: Register service instance
                CM->>DNS: Create DNS records
                DNS-->>CM: DNS records created

                VS->>DNS: Query customers.petclinic.local
                DNS-->>VS: Return IP addresses

                VS->>CS: Make service call
                CS-->>VS: Return response

                CM->>CW: Health check metrics
                CS->>CW: Service call metrics
        </div>

        <div class="description">
            <h2>Architecture Overview</h2>
            <div class="feature-list">
                <div class="feature-item">
                    <h3>üèóÔ∏è Frontend</h3>
                    <p>CloudFront CDN + S3 Static Website Hosting</p>
                </div>
                <div class="feature-item">
                    <h3>üê≥ Backend</h3>
                    <p>4 ECS Fargate Microservices (Customers, Vets, Visits, Admin Server) + API Gateway (AWS Managed)</p>
                </div>
                <div class="feature-item">
                    <h3>üóÑÔ∏è Database</h3>
                    <p>Aurora MySQL Multi-AZ with Primary/Replica and Auto-failover (Serverless v2)</p>
                </div>
                <div class="feature-item">
                    <h3>ü§ñ AI</h3>
                    <p>AWS Lambda + Amazon Bedrock (Claude/Titan models) - Fully Serverless</p>
                </div>
                <div class="feature-item">
                    <h3>üîí Security</h3>
                    <p>VPC with Multi-AZ, Public/Private Subnets, ALB, NAT Gateways, VPC Endpoints, WAF, IAM, Encryption</p>
                </div>
                <div class="feature-item">
                    <h3>üìä Monitoring</h3>
                    <p>CloudWatch (Logs, Metrics, Alarms), CloudTrail (Audit), X-Ray (Distributed Tracing)</p>
                </div>
                <div class="feature-item">
                    <h3>‚öôÔ∏è Configuration</h3>
                    <p>AWS Systems Manager Parameter Store (Config Server replacement)</p>
                </div>
                <div class="feature-item">
                    <h3>üîç Service Discovery</h3>
                    <p>AWS Cloud Map (Eureka replacement) with DNS-based discovery</p>
                </div>
            </div>

            <h2>Data Flow</h2>
            <ol>
                <li>Users access via CloudFront ‚Üí S3 static files or API Gateway ‚Üí Lambda/Aurora</li>
                <li>API calls routed through ALB to ECS microservices or directly to Lambda</li>
                <li>Services communicate via Cloud Map DNS-based service discovery</li>
                <li>Database operations via Aurora Multi-AZ with automatic failover</li>
                <li>AI features via Lambda ‚Üí Bedrock API with streaming responses</li>
                <li>All traffic monitored via CloudWatch/CloudTrail/X-Ray</li>
            </ol>

            <h2>AWS Well-Architected Framework Compliance</h2>
            <ul>
                <li><strong>Operational Excellence</strong>: IaC with Terraform, automated CI/CD, comprehensive monitoring</li>
                <li><strong>Security</strong>: IAM least privilege, VPC isolation, encryption at rest/transit</li>
                <li><strong>Reliability</strong>: Multi-AZ, auto-scaling, automated failover</li>
                <li><strong>Performance Efficiency</strong>: Serverless scaling, CDN, Aurora performance insights</li>
                <li><strong>Cost Optimization</strong>: Serverless pricing, managed services, auto-scaling</li>
                <li><strong>Sustainability</strong>: Efficient resource utilization, AWS green infrastructure</li>
            </ul>
        </div>
    </div>
</body>
</html>