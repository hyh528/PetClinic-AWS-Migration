# AWS ëª¨ë‹ˆí„°ë§ ì™„ë²½ ê°€ì´ë“œ

> PetClinic ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì˜ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œì„ ì²˜ìŒë¶€í„° ì´í•´í•˜ê¸°

---

## ëª©ì°¨

1. [ëª¨ë‹ˆí„°ë§ì´ë€ ë¬´ì—‡ì¸ê°€?](#1-ëª¨ë‹ˆí„°ë§ì´ë€-ë¬´ì—‡ì¸ê°€)
2. [ìš°ë¦¬ ì‹œìŠ¤í…œì˜ ëª¨ë‹ˆí„°ë§ êµ¬ì¡°](#2-ìš°ë¦¬-ì‹œìŠ¤í…œì˜-ëª¨ë‹ˆí„°ë§-êµ¬ì¡°)
3. [CloudWatchì˜ í•µì‹¬ ê°œë…](#3-cloudwatchì˜-í•µì‹¬-ê°œë…)
4. [ì‹¤ì „: AWS ì½˜ì†”ì—ì„œ ëª¨ë‹ˆí„°ë§ ë³´ê¸°](#4-ì‹¤ì „-aws-ì½˜ì†”ì—ì„œ-ëª¨ë‹ˆí„°ë§-ë³´ê¸°)
5. [ë¡œê·¸ í™•ì¸í•˜ëŠ” ë°©ë²•](#5-ë¡œê·¸-í™•ì¸í•˜ëŠ”-ë°©ë²•)
6. [ì•ŒëŒ(Alarm) ì´í•´í•˜ê¸°](#6-ì•ŒëŒalarm-ì´í•´í•˜ê¸°)
7. [Container Insights í™œìš©í•˜ê¸°](#7-container-insights-í™œìš©í•˜ê¸°)
8. [WAF ëª¨ë‹ˆí„°ë§](#8-waf-ëª¨ë‹ˆí„°ë§)
9. [ë¬¸ì œ í•´ê²° ì‹œë‚˜ë¦¬ì˜¤](#9-ë¬¸ì œ-í•´ê²°-ì‹œë‚˜ë¦¬ì˜¤)
10. [ë¹„ìš© ìµœì í™” íŒ](#10-ë¹„ìš©-ìµœì í™”-íŒ)

---

## 1. ëª¨ë‹ˆí„°ë§ì´ë€ ë¬´ì—‡ì¸ê°€?

### ì™œ ëª¨ë‹ˆí„°ë§ì´ í•„ìš”í•œê°€?

ì„œë¹„ìŠ¤ë¥¼ ìš´ì˜í•œë‹¤ëŠ” ê²ƒì€ 24ì‹œê°„ 365ì¼ ì‹ë‹¹ì„ ìš´ì˜í•˜ëŠ” ê²ƒê³¼ ë¹„ìŠ·í•©ë‹ˆë‹¤:

```
ì‹ë‹¹ ìš´ì˜                        ì„œë¹„ìŠ¤ ìš´ì˜
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ì†ë‹˜ì´ ì–¼ë§ˆë‚˜ ì™”ë‚˜?        â†’    ì‚¬ìš©ìê°€ ì–¼ë§ˆë‚˜ ì ‘ì†í–ˆë‚˜?
ì£¼ë°©ì´ ë°”ìœê°€?            â†’    ì„œë²„ CPUê°€ ë†’ì€ê°€?
ìŒì‹ì´ ëŠ¦ê²Œ ë‚˜ê°€ë‚˜?        â†’    ì‘ë‹µ ì†ë„ê°€ ëŠë¦°ê°€?
ì¬ë£Œê°€ ë¶€ì¡±í•œê°€?          â†’    ë©”ëª¨ë¦¬ê°€ ë¶€ì¡±í•œê°€?
ë¶ˆë§Œ ì ‘ìˆ˜ê°€ ìˆë‚˜?         â†’    ì—ëŸ¬ê°€ ë°œìƒí–ˆë‚˜?
```

**ëª¨ë‹ˆí„°ë§ = ì„œë¹„ìŠ¤ì˜ ê±´ê°• ìƒíƒœë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•˜ëŠ” ê²ƒ**

---

## 2. ìš°ë¦¬ ì‹œìŠ¤í…œì˜ ëª¨ë‹ˆí„°ë§ êµ¬ì¡°

### ì „ì²´ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì‚¬ìš©ì ìš”ì²­                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Route 53 (DNS)      â”‚ â—„â”€â”€â”€ í—¬ìŠ¤ ì²´í¬
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  CloudFront (CDN)     â”‚ â—„â”€â”€â”€ ì ‘ì† ë¡œê·¸, ìºì‹œ í†µê³„
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   WAF (ë³´ì•ˆ)           â”‚ â—„â”€â”€â”€ ê³µê²© ì°¨ë‹¨ í†µê³„
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   ALB (ë¡œë“œë°¸ëŸ°ì„œ)       â”‚ â—„â”€â”€â”€ ìš”ì²­ ìˆ˜, ì‘ë‹µ ì‹œê°„, HTTP ìƒíƒœ ì½”ë“œ
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                      â”‚
        â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ECS Service  â”‚    â”‚ ECS Service  â”‚ â—„â”€â”€â”€ CPU, ë©”ëª¨ë¦¬, ì‘ì—… ìˆ˜
â”‚ (customers)  â”‚    â”‚ (vets)       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚
       â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RDS        â”‚    â”‚  ElastiCache â”‚ â—„â”€â”€â”€ DB ì—°ê²°, ì¿¼ë¦¬ ì„±ëŠ¥, ìºì‹œ ì ì¤‘ë¥ 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  CloudWatch         â”‚
      â”‚  (í†µí•© ëª¨ë‹ˆí„°ë§)       â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                     â”‚
      â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ëŒ€ì‹œë³´ë“œ       â”‚    â”‚  ì•ŒëŒ + SNS   â”‚
â”‚ (ì‹œê°í™”)      â”‚    â”‚  (ì•Œë¦¼)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í…Œë¼í¼ ì½”ë“œ êµ¬ì¡°

```
terraform/
â”œâ”€â”€ layers/
â”‚   â”œâ”€â”€ 07-application/
â”‚   â”‚   â””â”€â”€ monitoring.tf          â† ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆì´ì–´ ëª¨ë‹ˆí„°ë§
â”‚   â””â”€â”€ 10-monitoring/
â”‚       â””â”€â”€ main.tf                 â† í†µí•© ëª¨ë‹ˆí„°ë§ ë ˆì´ì–´
â””â”€â”€ modules/
    â”œâ”€â”€ alb/                        â† ALB ë©”íŠ¸ë¦­
    â”œâ”€â”€ ecs/                        â† ECS ë©”íŠ¸ë¦­
    â”œâ”€â”€ rds/                        â† RDS ë©”íŠ¸ë¦­
    â””â”€â”€ cloudwatch/                 â† CloudWatch ëŒ€ì‹œë³´ë“œ & ì•ŒëŒ
```

**ê³„ì¸µë³„ ì—­í• :**

- **Layer 07 (Application)**: ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ì˜ ì¦‰ê°ì ì¸ ëª¨ë‹ˆí„°ë§
  - ALB, ECS ì„œë¹„ìŠ¤ì˜ ì‹¤ì‹œê°„ ì§€í‘œ
  - ì„œë¹„ìŠ¤ë³„ ëŒ€ì‹œë³´ë“œ ìœ„ì ¯
  
- **Layer 10 (Monitoring)**: ì „ì²´ ì‹œìŠ¤í…œì˜ í†µí•© ëª¨ë‹ˆí„°ë§
  - ëª¨ë“  ë ˆì´ì–´ì˜ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
  - í†µí•© ëŒ€ì‹œë³´ë“œ
  - ì•ŒëŒ ê´€ë¦¬

---

## 3. CloudWatchì˜ í•µì‹¬ ê°œë…

### 1) Metrics (ë©”íŠ¸ë¦­)

**ë©”íŠ¸ë¦­ = ìˆ«ìë¡œ ì¸¡ì • ê°€ëŠ¥í•œ ë°ì´í„°**

```
ì˜ˆì‹œ:
- CPU ì‚¬ìš©ë¥ : 45.2%
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: 1024 MB
- ìš”ì²­ ìˆ˜: 150 requests/min
- ì‘ë‹µ ì‹œê°„: 250 ms
```

#### ë©”íŠ¸ë¦­ì˜ êµ¬ì¡°

```
Namespace (ë„¤ì„ìŠ¤í˜ì´ìŠ¤): AWS/ECS, AWS/RDS, AWS/ApplicationELB
    â”‚
    â”œâ”€ Metric Name (ë©”íŠ¸ë¦­ ì´ë¦„): CPUUtilization, MemoryUtilization
    â”‚
    â””â”€ Dimensions (ì°¨ì›): ë©”íŠ¸ë¦­ì„ ì‹ë³„í•˜ëŠ” í‚¤-ê°’ ìŒ
           â”œâ”€ ServiceName: petclinic-dev-customers-service
           â”œâ”€ ClusterName: petclinic-dev-cluster
           â””â”€ Region: us-west-2
```

**ìš°ë¦¬ê°€ ìˆ˜ì§‘í•˜ëŠ” ì£¼ìš” ë©”íŠ¸ë¦­:**

| ë¦¬ì†ŒìŠ¤ | ë„¤ì„ìŠ¤í˜ì´ìŠ¤ | ì£¼ìš” ë©”íŠ¸ë¦­ |
|--------|-------------|------------|
| **ECS** | AWS/ECS | CPUUtilization, MemoryUtilization, RunningTaskCount |
| **ALB** | AWS/ApplicationELB | RequestCount, TargetResponseTime, HTTPCode_Target_2XX_Count |
| **RDS** | AWS/RDS | CPUUtilization, DatabaseConnections, FreeableMemory |
| **ElastiCache** | AWS/ElastiCache | CPUUtilization, CacheHits, CacheMisses |
| **WAF** | AWS/WAFV2 | AllowedRequests, BlockedRequests, CountedRequests |

### 2) Logs (ë¡œê·¸)

**ë¡œê·¸ = ì‹œìŠ¤í…œì´ ë‚¨ê¸°ëŠ” ì¼ê¸°ì¥**

```
ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ ì˜ˆì‹œ:
2024-01-15 10:30:45 INFO  CustomerController - GET /api/customers/1
2024-01-15 10:30:45 INFO  Database - Query executed in 45ms
2024-01-15 10:30:45 ERROR OrderService - Failed to process order: Connection timeout
```

#### ë¡œê·¸ ê·¸ë£¹ êµ¬ì¡°

```
CloudWatch Logs
â”‚
â”œâ”€ /ecs/petclinic-dev-customers        â† ECS ì»¨í…Œì´ë„ˆ ë¡œê·¸
â”‚   â”œâ”€ Stream: customers/task-123
â”‚   â””â”€ Stream: customers/task-456
â”‚
â”œâ”€ /ecs/petclinic-dev-vets             â† ECS ì»¨í…Œì´ë„ˆ ë¡œê·¸
â”‚   â””â”€ Stream: vets/task-789
â”‚
â”œâ”€ /aws/rds/instance/petclinic-dev/error   â† RDS ì—ëŸ¬ ë¡œê·¸
â”‚
â””â”€ /aws/rds/instance/petclinic-dev/slowquery   â† RDS ëŠë¦° ì¿¼ë¦¬ ë¡œê·¸
```

**ë¡œê·¸ ë³´ê´€ ê¸°ê°„:**
- ê¸°ë³¸ ì„¤ì •: 30ì¼
- ë¹„ìš© ì ˆê°: 7ì¼ ë˜ëŠ” 14ì¼ë¡œ ì¡°ì • ê°€ëŠ¥
- ê·œì • ì¤€ìˆ˜: í•„ìš”ì‹œ 1ë…„ ì´ìƒ ë³´ê´€

### 3) Alarms (ì•ŒëŒ)

**ì•ŒëŒ = ë¬¸ì œê°€ ìƒê²¼ì„ ë•Œ ìë™ìœ¼ë¡œ ì•Œë ¤ì£¼ëŠ” ì‹œìŠ¤í…œ**

```
ì•ŒëŒ ì‘ë™ ì›ë¦¬:

1. ì¡°ê±´ ì„¤ì •
   "ë§Œì•½ CPU ì‚¬ìš©ë¥ ì´ 80%ë¥¼ ë„˜ìœ¼ë©´"

2. í‰ê°€ ê¸°ê°„
   "5ë¶„ ë™ì•ˆ ì—°ì†ìœ¼ë¡œ 3ë²ˆ í™•ì¸"

3. ìƒíƒœ ë³€ê²½
   OK â†’ ALARM

4. ì•¡ì…˜ ì‹¤í–‰
   SNS Topic â†’ ì´ë©”ì¼/Slack ì•Œë¦¼
```

#### ì•ŒëŒ ìƒíƒœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   OK    â”‚  â† ì •ìƒ ìƒíƒœ
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ ì„ê³„ê°’ ì´ˆê³¼
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ALARM  â”‚  â† ì•ŒëŒ ë°œìƒ! ğŸ“¢
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ ë¬¸ì œ í•´ê²°
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   OK    â”‚  â† ì •ìƒ ë³µêµ¬
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ìš°ë¦¬ê°€ ì„¤ì •í•œ ì£¼ìš” ì•ŒëŒ (20ê°œ):**

| ì•ŒëŒ ì´ë¦„ | ì¡°ê±´ | ì„ê³„ê°’ | ì˜ë¯¸ |
|----------|------|--------|------|
| **ecs-cpu-high** | CPU ì‚¬ìš©ë¥  > 80% | 5ë¶„ê°„ 2íšŒ | ì„œë²„ê°€ ê³¼ë¶€í•˜ ìƒíƒœ |
| **ecs-memory-high** | ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  > 80% | 5ë¶„ê°„ 2íšŒ | ë©”ëª¨ë¦¬ ë¶€ì¡± |
| **alb-5xx-errors** | 5XX ì—ëŸ¬ > 10ê°œ | 5ë¶„ê°„ 1íšŒ | ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ ë‹¤ë°œ |
| **alb-response-time** | ì‘ë‹µ ì‹œê°„ > 3ì´ˆ | 5ë¶„ê°„ 2íšŒ | ì„œë¹„ìŠ¤ ëŠë¦¼ |
| **rds-cpu-high** | DB CPU > 80% | 10ë¶„ê°„ 2íšŒ | DB ê³¼ë¶€í•˜ |
| **rds-connections** | DB ì—°ê²° > 80 | 5ë¶„ê°„ 2íšŒ | DB ì—°ê²° ë¶€ì¡± |

### 4) Dashboard (ëŒ€ì‹œë³´ë“œ)

**ëŒ€ì‹œë³´ë“œ = í•œ ëˆˆì— ë³´ëŠ” ì‹œìŠ¤í…œ í˜„í™©íŒ**
---

| ì§€í‘œ | í˜„ì¬ ìƒíƒœ | ìƒì„¸ ë‚´ì—­ | ì¡°ì¹˜ í•„ìš”ì„± |
| :--- | :--- | :--- | :--- |
| **ECS CPU ì‚¬ìš©ë¥  (í‰ê· )** | **ë†’ìŒ** | 60% (**ì£¼ì˜**) | ğŸ”´ ë†’ìŒ |
| **ALB ìš”ì²­ ìˆ˜ (Max)** | 500 req/min | íŠ¸ë˜í”½ ë³€ë™ ì‹¬í•¨ | ğŸŸ  ì¤‘ê°„ |
| **RDS DB ì—°ê²°ë¥ ** | 45% | 45/100 ì—°ê²° | ğŸŸ¢ ë‚®ìŒ |

---

### 1. ECS ì„œë¹„ìŠ¤ ìì› ì‚¬ìš©ë¥  (CPU)

* **vets (ìˆ˜ì˜ì‚¬):** **80%**
    * `[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘]`
    * **ğŸš¨ ê²½ê³ :** CPU ì„ê³„ì¹˜ ì´ˆê³¼. ì¦‰ê°ì ì¸ ì¡°ì¹˜ í•„ìš”.
* **customers (ê³ ê°):** **60%**
    * `[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘]`
    * **âš ï¸ ì£¼ì˜:** ë¶€í•˜ ì¦ê°€ ì¶”ì´ í™•ì¸ í•„ìš”.
* **visits (ë°©ë¬¸):** **30%**
    * `[â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘]`
    * **âœ… ì–‘í˜¸:** í˜„ì¬ ë¶€í•˜ ë‚®ìŒ.

---

### 2. ALB (Application Load Balancer) ìš”ì²­ íŠ¸ë˜í”½

```
500 req/min   â–²
              â”‚    â•±â•²
 400          â”‚   â•±  â•²    â•±â•²
 300          â”‚  â•±    â•²  â•±  â•²
 200          â”‚ â•±      â•²â•±    â•²
 100          â”‚/
   0          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Time
```
ìµœëŒ€ ìš”ì²­ ìˆ˜: 500 req/min

ìƒíƒœ: ì£¼ê¸°ì ì¸ í”¼í¬ ë°œìƒ. Auto Scaling ì„¤ì • ì ê²€ ê¶Œì¥.

---

### 3. RDS ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ìƒíƒœ

* **í˜„ì¬ ì—°ê²°:** **45** / 100
* **ì—°ê²°ë¥ :** 45%
* **ë§‰ëŒ€:** `[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘]`
* **ìƒíƒœ:** ğŸŸ¢ ì–‘í˜¸.

---
**ëŒ€ì‹œë³´ë“œ êµ¬ì„± (6ê°œ ìœ„ì ¯):**

1. **ECS ì„œë¹„ìŠ¤ CPU ì‚¬ìš©ë¥ **: ëª¨ë“  ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì˜ CPU ìƒíƒœ
2. **ECS ì„œë¹„ìŠ¤ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ **: ë©”ëª¨ë¦¬ ì‚¬ìš© í˜„í™©
3. **ALB ìš”ì²­ ìˆ˜**: ì‹œê°„ë³„ íŠ¸ë˜í”½ íŒ¨í„´
4. **ALB HTTP ìƒíƒœ ì½”ë“œ**: 2XX, 4XX, 5XX ë¶„í¬
5. **RDS CPU & ì—°ê²°**: ë°ì´í„°ë² ì´ìŠ¤ ë¶€í•˜
6. **ElastiCache ìºì‹œ ì ì¤‘ë¥ **: ìºì‹œ íš¨ìœ¨ì„±

### 5) Container Insights

**Container Insights = ECS ì»¨í…Œì´ë„ˆ ì „ìš© ì‹¬í™” ëª¨ë‹ˆí„°ë§**

ì¼ë°˜ ë©”íŠ¸ë¦­ê³¼ì˜ ì°¨ì´:

```
ì¼ë°˜ CloudWatch ë©”íŠ¸ë¦­:
- ì„œë¹„ìŠ¤ ë ˆë²¨ (í‰ê· ê°’)
- customers ì„œë¹„ìŠ¤ ì „ì²´ CPU: 60%

Container Insights:
- ê°œë³„ ì‘ì—…(Task) ë ˆë²¨ (ìƒì„¸ê°’)
- customers-task-123: CPU 45%, Memory 512MB
- customers-task-456: CPU 75%, Memory 768MB
```

**ìˆ˜ì§‘ ë°ì´í„°:**
- CPU, ë©”ëª¨ë¦¬ (ì‘ì—…ë³„, ì»¨í…Œì´ë„ˆë³„)
- ë„¤íŠ¸ì›Œí¬ I/O
- ë””ìŠ¤í¬ I/O
- ë¡œê·¸ ë©”íŠ¸ë¦­ í•„í„°

**ë¹„ìš©:**
- ì•½ $0.50 per task per month
- 10ê°œ ì‘ì—… â†’ ì›” $5

---

## 4. ì‹¤ì „: AWS ì½˜ì†”ì—ì„œ ëª¨ë‹ˆí„°ë§ ë³´ê¸°

### Step 1: CloudWatch ëŒ€ì‹œë³´ë“œ ì ‘ê·¼

```
1. AWS ì½˜ì†” ë¡œê·¸ì¸
   https://console.aws.amazon.com/

2. ì„œë¹„ìŠ¤ ê²€ìƒ‰
   "CloudWatch" ì…ë ¥ â†’ ì„ íƒ

3. ì™¼ìª½ ë©”ë‰´
   Dashboards â†’ "petclinic-dev-Dashboard" ì„ íƒ
```

**URL ì§ì ‘ ì ‘ê·¼:**
```
https://us-west-2.console.aws.amazon.com/cloudwatch/home?region=us-west-2#dashboards:name=petclinic-dev-Dashboard
```

### Step 2: ëŒ€ì‹œë³´ë“œ ì½ëŠ” ë²•

#### Widget 1: ECS CPU ì‚¬ìš©ë¥ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ECS Service CPU (%)                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚  customers  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  50%    â”‚
â”‚  vets       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  80%    â”‚  â† ë†’ìŒ! ì£¼ì˜ í•„ìš”
â”‚  visits     â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  20%    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•´ì„:**
- âœ… **0-60%**: ì •ìƒ
- âš ï¸ **60-80%**: ì£¼ì˜ (ìŠ¤ì¼€ì¼ë§ ê³ ë ¤)
- ğŸš¨ **80-100%**: ìœ„í—˜ (ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”)

**ì¡°ì¹˜ ë°©ë²•:**
```bash
# ECS ì‘ì—… ìˆ˜ ëŠ˜ë¦¬ê¸°
aws ecs update-service \
  --cluster petclinic-dev-cluster \
  --service petclinic-dev-vets-service \
  --desired-count 3  # 2 â†’ 3ìœ¼ë¡œ ì¦ê°€
```

#### Widget 2: ALB ìš”ì²­ ìˆ˜

```
ê·¸ë˜í”„ íŒ¨í„´ ë¶„ì„:

ì •ìƒ íŒ¨í„´:
  â”‚     â•±â•²    â•±â•²    â•±â•²
  â”‚    â•±  â•²  â•±  â•²  â•±  â•²
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
     ë‚®  ë†’  ë‚®  ë†’  ë‚®  ë†’
     (ì¼ì •í•œ íŒ¨í„´)

ë¹„ì •ìƒ íŒ¨í„´:
  â”‚          â•±â”‚â•²
  â”‚         â•± â”‚ â•²
  â”‚        â•±  â”‚  â•²
  â”‚    â”€â”€â”€    â”‚   â”€â”€â”€â”€
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
     ê¸‰ê²©í•œ ìŠ¤íŒŒì´í¬ (DDoS ê°€ëŠ¥ì„±?)
```

#### Widget 4: HTTP ìƒíƒœ ì½”ë“œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HTTP Status Codes                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚  2XX  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  95%    â”‚ â† ì„±ê³µ
â”‚  4XX  â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   4%    â”‚ â† í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¥˜
â”‚  5XX  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   1%    â”‚ â† ì„œë²„ ì˜¤ë¥˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ìƒíƒœ ì½”ë“œ ì˜ë¯¸:**

| ì½”ë“œ | ì˜ë¯¸ | ì›ì¸ | ì¡°ì¹˜ |
|------|------|------|------|
| **2XX** | ì„±ê³µ | ì •ìƒ ì²˜ë¦¬ | ì—†ìŒ |
| **4XX** | í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¥˜ | ì˜ëª»ëœ ìš”ì²­, ê¶Œí•œ ì—†ìŒ | í´ë¼ì´ì–¸íŠ¸ ìˆ˜ì • í•„ìš” |
| **5XX** | ì„œë²„ ì˜¤ë¥˜ | ì„œë²„ ë‚´ë¶€ ë¬¸ì œ | ì¦‰ì‹œ ë¡œê·¸ í™•ì¸ |

**ì •ìƒ ë¹„ìœ¨:**
- 2XX: 95% ì´ìƒ
- 4XX: 5% ì´í•˜ (ì •ìƒì ì¸ ì—ëŸ¬)
- 5XX: 1% ì´í•˜ (ëª©í‘œ: 0%)

### Step 3: ë©”íŠ¸ë¦­ ìƒì„¸ ë³´ê¸°

```
ëŒ€ì‹œë³´ë“œì—ì„œ ìœ„ì ¯ í´ë¦­
  â†“
"View in metrics" ë²„íŠ¼ í´ë¦­
  â†“
Metrics íƒ­ì—ì„œ ìƒì„¸ ì„¤ì • ê°€ëŠ¥:
  - ì‹œê°„ ë²”ìœ„ ë³€ê²½ (1ì‹œê°„, 1ì¼, 1ì£¼ì¼)
  - í†µê³„ ë°©ë²• (Average, Maximum, Minimum)
  - ê¸°ê°„(Period) ì¡°ì • (1ë¶„, 5ë¶„, 1ì‹œê°„)
```

**ìœ ìš©í•œ ì‹œê°„ ë²”ìœ„:**

- **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**: ìµœê·¼ 1ì‹œê°„
- **ì¼ì¼ ì ê²€**: ìµœê·¼ 24ì‹œê°„
- **ì£¼ê°„ ë¦¬ë·°**: ìµœê·¼ 7ì¼
- **ì›”ê°„ ë³´ê³ ì„œ**: ìµœê·¼ 30ì¼

---

## 5. ë¡œê·¸ í™•ì¸í•˜ëŠ” ë°©ë²•

### Step 1: CloudWatch Logs ì ‘ê·¼

```
CloudWatch ì½˜ì†”
  â†“
ì™¼ìª½ ë©”ë‰´: Logs â†’ Log groups
  â†“
ê²€ìƒ‰: "petclinic"
  â†“
ë¡œê·¸ ê·¸ë£¹ ì„ íƒ
```

### ì£¼ìš” ë¡œê·¸ ê·¸ë£¹

```
/ecs/petclinic-dev-customers
â”œâ”€ ìš©ë„: Customers ì„œë¹„ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸
â”œâ”€ ë‚´ìš©: API ìš”ì²­, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ì—ëŸ¬
â””â”€ ì˜ˆì‹œ:
   2024-01-15 10:30:45 INFO  [main] CustomerController
   - Processing GET request for customer ID: 123

/ecs/petclinic-dev-vets
â”œâ”€ ìš©ë„: Vets ì„œë¹„ìŠ¤ ë¡œê·¸
â””â”€ ë‚´ìš©: ìˆ˜ì˜ì‚¬ ê´€ë ¨ API ë¡œê·¸

/aws/rds/instance/petclinic-dev/error
â”œâ”€ ìš©ë„: RDS ì—ëŸ¬ ë¡œê·¸
â””â”€ ì˜ˆì‹œ:
   2024-01-15 10:45:30 ERROR Database connection failed
   Connection timeout after 30s

/aws/rds/instance/petclinic-dev/slowquery
â”œâ”€ ìš©ë„: ëŠë¦° ì¿¼ë¦¬ ë¡œê·¸
â””â”€ ì˜ˆì‹œ:
   Query_time: 5.234000  Lock_time: 0.000000
   SELECT * FROM customers WHERE name LIKE '%john%'
```

### Step 2: ë¡œê·¸ ê²€ìƒ‰í•˜ê¸°

#### ê¸°ë³¸ ê²€ìƒ‰

```
1. ë¡œê·¸ ê·¸ë£¹ ì„ íƒ: /ecs/petclinic-dev-customers

2. "Search log group" ì…ë ¥ë€ì— ê²€ìƒ‰ì–´ ì…ë ¥

3. ì‹œê°„ ë²”ìœ„ ì„ íƒ: 1h, 6h, 1d, 7d, Custom

4. ê²€ìƒ‰!
```

#### CloudWatch Logs Insights (ê³ ê¸‰ ê²€ìƒ‰)

```sql
-- ì—ëŸ¬ ë¡œê·¸ë§Œ í•„í„°ë§
fields @timestamp, @message
| filter @message like /ERROR/
| sort @timestamp desc
| limit 100

-- íŠ¹ì • ê³ ê° ID ê´€ë ¨ ë¡œê·¸
fields @timestamp, @message
| filter @message like /customer.*123/
| sort @timestamp desc

-- ëŠë¦° ì‘ë‹µ ì‹œê°„ ë¡œê·¸ (3ì´ˆ ì´ìƒ)
fields @timestamp, @message, response_time
| filter response_time > 3000
| sort response_time desc
| limit 50

-- ì‹œê°„ëŒ€ë³„ ì—ëŸ¬ ì¹´ìš´íŠ¸
fields @timestamp
| filter @message like /ERROR/
| stats count() by bin(1h)
```

**Logs Insights ì ‘ê·¼:**
```
CloudWatch â†’ Logs â†’ Logs Insights
  â†“
ë¡œê·¸ ê·¸ë£¹ ì„ íƒ (ì—¬ëŸ¬ ê°œ ê°€ëŠ¥)
  â†“
ì¿¼ë¦¬ ì…ë ¥
  â†“
"Run query" ì‹¤í–‰
```

### Step 3: ë¡œê·¸ íŒ¨í„´ ë¶„ì„

**ì •ìƒ ë¡œê·¸ íŒ¨í„´:**
```
10:00 INFO  GET /api/customers - 200 OK - 45ms
10:01 INFO  GET /api/vets - 200 OK - 32ms
10:02 INFO  POST /api/visits - 201 Created - 120ms
10:03 INFO  GET /api/customers/123 - 200 OK - 28ms
```

**ë¬¸ì œ ë¡œê·¸ íŒ¨í„´:**
```
10:00 ERROR Database connection timeout
10:00 ERROR Database connection timeout
10:00 ERROR Database connection timeout
10:01 ERROR Out of memory: heap space
10:01 WARN  Circuit breaker opened for CustomerService
```

**ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”í•œ í‚¤ì›Œë“œ:**
- `ERROR`
- `FATAL`
- `Exception`
- `OutOfMemoryError`
- `Connection refused`
- `Timeout`
- `Circuit breaker opened`

---

## 6. ì•ŒëŒ(Alarm) ì´í•´í•˜ê¸°

### Step 1: ì•ŒëŒ ìƒíƒœ í™•ì¸

```
CloudWatch ì½˜ì†”
  â†“
ì™¼ìª½ ë©”ë‰´: Alarms â†’ All alarms
  â†“
í•„í„°: "petclinic"
```

**ì•ŒëŒ ëª©ë¡ ì˜ˆì‹œ:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Alarm Name                          â”‚  State   â”‚  Updated    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ petclinic-dev-ecs-cpu-high          â”‚  OK âœ…   â”‚  5 min ago  â”‚
â”‚ petclinic-dev-ecs-memory-high       â”‚  OK âœ…   â”‚  5 min ago  â”‚
â”‚ petclinic-dev-alb-5xx-errors        â”‚ ALARM ğŸš¨ â”‚  2 min ago  â”‚
â”‚ petclinic-dev-alb-response-time     â”‚  OK âœ…   â”‚  5 min ago  â”‚
â”‚ petclinic-dev-rds-cpu-high          â”‚  OK âœ…   â”‚  10 min ago â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 2: ì•ŒëŒ ì•Œë¦¼ ì„¤ì •

#### SNS Topic êµ¬ë…

```
1. SNS ì½˜ì†”ë¡œ ì´ë™
   https://console.aws.amazon.com/sns/

2. Topics ì„ íƒ
   petclinic-dev-alerts ì°¾ê¸°

3. "Create subscription" í´ë¦­

4. Protocol ì„ íƒ:
   - Email: ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥
   - SMS: ì „í™”ë²ˆí˜¸ ì…ë ¥
   - Slack: Lambda + Webhook í•„ìš”

5. ì´ë©”ì¼ í™•ì¸
   ë°›ì€ í¸ì§€í•¨ì—ì„œ "Confirm subscription" í´ë¦­
```

#### ì•ŒëŒ ì´ë©”ì¼ ì˜ˆì‹œ

```
Subject: ALARM: "petclinic-dev-alb-5xx-errors" in US West (Oregon)

You are receiving this email because your Amazon CloudWatch Alarm 
"petclinic-dev-alb-5xx-errors" in the US West (Oregon) region has 
entered the ALARM state.

Alarm Details:
- State Change: OK -> ALARM
- Reason: Threshold Crossed: 15 datapoints [23.0, 18.0, 25.0, ...] 
  were greater than the threshold (10.0).
- Timestamp: 2024-01-15 10:45:00 UTC

Alarm "petclinic-dev-alb-5xx-errors" is currently in ALARM state.

View this alarm in the AWS Console:
https://console.aws.amazon.com/cloudwatch/home?region=us-west-2#...
```

### Step 3: ì•ŒëŒ ëŒ€ì‘ í”„ë¡œì„¸ìŠ¤

```
ì•ŒëŒ ë°œìƒ! ğŸš¨
  â†“
1. ì‹¬ê°ë„ íŒë‹¨
   â”œâ”€ CRITICAL: ì¦‰ì‹œ ëŒ€ì‘
   â”œâ”€ HIGH: 30ë¶„ ë‚´ ëŒ€ì‘
   â””â”€ MEDIUM: 2ì‹œê°„ ë‚´ ëŒ€ì‘
  â†“
2. í˜„í™© íŒŒì•…
   â”œâ”€ ëŒ€ì‹œë³´ë“œ í™•ì¸
   â”œâ”€ ë¡œê·¸ ê²€ìƒ‰
   â””â”€ ì˜í–¥ ë²”ìœ„ í™•ì¸
  â†“
3. ì›ì¸ ë¶„ì„
   â”œâ”€ CPU/ë©”ëª¨ë¦¬ ë¶€ì¡±?
   â”œâ”€ DB ì—°ê²° ë¬¸ì œ?
   â”œâ”€ ì™¸ë¶€ API ì¥ì• ?
   â””â”€ ì½”ë“œ ë²„ê·¸?
  â†“
4. ì¡°ì¹˜ ì‹¤í–‰
   â”œâ”€ ê¸´ê¸‰: ë¡¤ë°±
   â”œâ”€ ìŠ¤ì¼€ì¼ë§
   â”œâ”€ ì¬ì‹œì‘
   â””â”€ í•«í”½ìŠ¤ ë°°í¬
  â†“
5. í™•ì¸ ë° ê¸°ë¡
   â”œâ”€ ì•ŒëŒ í•´ì œ í™•ì¸
   â”œâ”€ ì‚¬í›„ ë¶„ì„
   â””â”€ ë¬¸ì„œí™”
```

### ğŸ“‹ ì•ŒëŒë³„ ëŒ€ì‘ ê°€ì´ë“œ

#### 1. **ecs-cpu-high** (CPU 80% ì´ìƒ)

**ì›ì¸:**
- íŠ¸ë˜í”½ ê¸‰ì¦
- ë¹„íš¨ìœ¨ì ì¸ ì½”ë“œ
- ë¬´í•œ ë£¨í”„

**ì¡°ì¹˜:**
```bash
# 1. í˜„ì¬ ì‘ì—… ìˆ˜ í™•ì¸
aws ecs describe-services \
  --cluster petclinic-dev-cluster \
  --services petclinic-dev-customers-service

# 2. ì‘ì—… ìˆ˜ ì¦ê°€ (ìŠ¤ì¼€ì¼ ì•„ì›ƒ)
aws ecs update-service \
  --cluster petclinic-dev-cluster \
  --service petclinic-dev-customers-service \
  --desired-count 4  # 2 â†’ 4ë¡œ ì¦ê°€

# 3. ë¡œê·¸ í™•ì¸
aws logs tail /ecs/petclinic-dev-customers --follow
```

#### 2. **alb-5xx-errors** (5XX ì—ëŸ¬ 10ê°œ ì´ìƒ)

**ì›ì¸:**
- ì• í”Œë¦¬ì¼€ì´ì…˜ í¬ë˜ì‹œ
- DB ì—°ê²° ì‹¤íŒ¨
- ë©”ëª¨ë¦¬ ë¶€ì¡±

**ì¡°ì¹˜:**
```bash
# 1. ì—ëŸ¬ ë¡œê·¸ ê¸´ê¸‰ í™•ì¸
aws logs filter-log-events \
  --log-group-name /ecs/petclinic-dev-customers \
  --filter-pattern "ERROR" \
  --start-time $(date -d '10 minutes ago' +%s)000

# 2. í—¬ìŠ¤ ì²´í¬ ìƒíƒœ
aws elbv2 describe-target-health \
  --target-group-arn <TARGET_GROUP_ARN>

# 3. ì„œë¹„ìŠ¤ ì¬ì‹œì‘ (ìµœí›„ ìˆ˜ë‹¨)
aws ecs update-service \
  --cluster petclinic-dev-cluster \
  --service petclinic-dev-customers-service \
  --force-new-deployment
```

#### 3. **rds-cpu-high** (DB CPU 80% ì´ìƒ)

**ì›ì¸:**
- ë¹„íš¨ìœ¨ì ì¸ ì¿¼ë¦¬
- ì¸ë±ìŠ¤ ë¶€ì¡±
- ë™ì‹œ ì—°ê²° ê³¼ë‹¤

**ì¡°ì¹˜:**
```bash
# 1. ëŠë¦° ì¿¼ë¦¬ ë¡œê·¸ í™•ì¸
aws rds describe-db-log-files \
  --db-instance-identifier petclinic-dev

aws rds download-db-log-file-portion \
  --db-instance-identifier petclinic-dev \
  --log-file-name slowquery/mysql-slowquery.log

# 2. í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì¿¼ë¦¬ í™•ì¸ (RDS ì ‘ì† í›„)
SHOW FULL PROCESSLIST;

# 3. ìºì‹œ í™•ì¸ (ElastiCache í™œìš©)
# ìºì‹œ ì ì¤‘ë¥ ì´ ë‚®ë‹¤ë©´ ìºì‹œ ì „ëµ ì¬ê²€í† 
```

#### 4. **alb-response-time** (ì‘ë‹µ ì‹œê°„ 3ì´ˆ ì´ìƒ)

**ì›ì¸:**
- DB ì¿¼ë¦¬ ëŠë¦¼
- ì™¸ë¶€ API ì§€ì—°
- ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ

**ì¡°ì¹˜:**
```bash
# 1. íƒ€ê²Ÿ ê·¸ë£¹ë³„ ì‘ë‹µ ì‹œê°„ í™•ì¸
aws cloudwatch get-metric-statistics \
  --namespace AWS/ApplicationELB \
  --metric-name TargetResponseTime \
  --dimensions Name=LoadBalancer,Value=app/petclinic-dev-alb/... \
  --statistics Average \
  --start-time $(date -u -d '1 hour ago' +%Y-%m-%dT%H:%M:%S) \
  --end-time $(date -u +%Y-%m-%dT%H:%M:%S) \
  --period 300

# 2. APM ë„êµ¬ë¡œ ë³‘ëª© ì§€ì  íŒŒì•… (X-Ray ë“±)

# 3. ìºì‹± ì „ëµ ê²€í† 
```

---

## 7. Container Insights í™œìš©í•˜ê¸°

### Step 1: Container Insights í™œì„±í™” í™•ì¸

```bash
# ECS í´ëŸ¬ìŠ¤í„° ì„¤ì • í™•ì¸
aws ecs describe-clusters \
  --clusters petclinic-dev-cluster \
  --include SETTINGS
```

**ì¶œë ¥ í™•ì¸:**
```json
{
  "settings": [
    {
      "name": "containerInsights",
      "value": "enabled"  â† í™œì„±í™” ìƒíƒœ
    }
  ]
}
```

### Step 2: Container Insights ëŒ€ì‹œë³´ë“œ

```
CloudWatch ì½˜ì†”
  â†“
ì™¼ìª½ ë©”ë‰´: Insights â†’ Container Insights
  â†“
"ECS Services" ë·° ì„ íƒ
  â†“
í´ëŸ¬ìŠ¤í„°: petclinic-dev-cluster
```

**ë³´ê¸° ì˜µì…˜:**

1. **Performance monitoring**: ì„±ëŠ¥ ë©”íŠ¸ë¦­
   - CPU, ë©”ëª¨ë¦¬, ë„¤íŠ¸ì›Œí¬, ë””ìŠ¤í¬
   
2. **Map view**: ì„œë¹„ìŠ¤ ë§µ
   ```
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   ALB   â”‚â”€â”€â”€â”€â”€â”€â”‚customersâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   RDS   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ```

3. **List view**: ì„œë¹„ìŠ¤ ëª©ë¡
   ```
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Service        â”‚ CPU  â”‚ Memory â”‚ Tasks    â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ customers      â”‚  45% â”‚  60%   â”‚ 2/2      â”‚
   â”‚ vets           â”‚  30% â”‚  45%   â”‚ 2/2      â”‚
   â”‚ visits         â”‚  25% â”‚  40%   â”‚ 2/2      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ```

### Step 3: ì‘ì—…(Task) ë ˆë²¨ ìƒì„¸ ë¶„ì„

```
Container Insights â†’ ECS Tasks
  â†“
ì„œë¹„ìŠ¤ ì„ íƒ: petclinic-dev-customers-service
  â†“
ê°œë³„ ì‘ì—… í´ë¦­: customers-task-abc123
```

**ì‘ì—…ë³„ ë©”íŠ¸ë¦­:**
```
Task: customers-task-abc123
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CPU Utilization:        45% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
Memory Utilization:     60% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘
Network Rx (MB/s):      2.5 â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
Network Tx (MB/s):      1.8 â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘

Container: customers-api
  CPU:     40%
  Memory:  512 MB / 1024 MB
  Status:  RUNNING âœ…
  Uptime:  2h 35m

Logs:
  /ecs/petclinic-dev-customers â†’ Stream: customers/task-abc123
```

### ğŸ“ˆ ìœ ìš©í•œ Container Insights ì¿¼ë¦¬

```sql
-- 1. CPU ì‚¬ìš©ë¥  Top 5 ì‘ì—…
fields @timestamp, TaskId, CpuUtilized
| filter ServiceName = "petclinic-dev-customers-service"
| sort CpuUtilized desc
| limit 5

-- 2. ë©”ëª¨ë¦¬ ì‚¬ìš© ì¶”ì´
fields @timestamp, TaskId, MemoryUtilized
| filter ServiceName = "petclinic-dev-customers-service"
| stats avg(MemoryUtilized) by bin(5m)

-- 3. ë„¤íŠ¸ì›Œí¬ I/O ë¶„ì„
fields @timestamp, NetworkRxBytes, NetworkTxBytes
| filter ServiceName = "petclinic-dev-customers-service"
| stats sum(NetworkRxBytes)/1024/1024 as RxMB, 
        sum(NetworkTxBytes)/1024/1024 as TxMB 
  by bin(1h)
```

---

## 8. WAF ëª¨ë‹ˆí„°ë§

### WAFë€?

**WAF (Web Application Firewall) = ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°©í™”ë²½**

```
ì•…ì˜ì ì¸ ìš”ì²­              ì •ìƒ ìš”ì²­
     â†“                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸš« ì°¨ë‹¨  â”‚            â”‚ âœ… í—ˆìš© â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“                       â†“
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘         WAF               â•‘
  â•‘  - SQL Injection ì°¨ë‹¨      â•‘
  â•‘  - XSS ê³µê²© ì°¨ë‹¨            â•‘
  â•‘  - Rate Limiting          â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   ALB   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### WAF ë©”íŠ¸ë¦­ ë³´ê¸°

```
CloudWatch ì½˜ì†”
  â†“
Metrics â†’ All metrics
  â†“
"WAFV2" ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì„ íƒ
  â†“
WebACL ì„ íƒ: petclinic-dev-alb-waf
```

**ì£¼ìš” WAF ë©”íŠ¸ë¦­:**

| ë©”íŠ¸ë¦­ | ì˜ë¯¸ | ì •ìƒ ë²”ìœ„ |
|--------|------|----------|
| **AllowedRequests** | í—ˆìš©ëœ ìš”ì²­ ìˆ˜ | ëŒ€ë¶€ë¶„ì˜ íŠ¸ë˜í”½ |
| **BlockedRequests** | ì°¨ë‹¨ëœ ìš”ì²­ ìˆ˜ | < 5% |
| **CountedRequests** | ì¹´ìš´íŠ¸ë§Œ í•œ ìš”ì²­ | í…ŒìŠ¤íŠ¸ ëª¨ë“œ |

### ğŸ” WAF ë¡œê·¸ vs ë©”íŠ¸ë¦­

**ìš°ë¦¬ê°€ ì œê±°í•œ ê²ƒ: WAF ë¡œê·¸**
```
âŒ ì œê±°ë¨: WAF ë¡œê·¸ (ìƒì„¸ ì •ë³´)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- IP ì£¼ì†Œ: 203.0.113.45
- ìš”ì²­ ì‹œê°„: 2024-01-15 10:30:45
- HTTP Method: GET
- URI: /api/customers?id=1' OR '1'='1
- Headers: User-Agent, Cookie, ...
- Action: BLOCK
- Rule: SQLi_QUERYARGUMENTS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ë¹„ìš©: ì›” $50-60
ìš©ë„: í¬ë Œì‹ ë¶„ì„, ìƒì„¸ ë³´ì•ˆ ê°ì‚¬
```

**ìš°ë¦¬ê°€ ìœ ì§€í•œ ê²ƒ: WAF ë©”íŠ¸ë¦­**
```
âœ… ìœ ì§€ë¨: WAF ë©”íŠ¸ë¦­ (í†µê³„ ì •ë³´)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- ì‹œê°„: 10:00-10:05
- AllowedRequests: 1,245
- BlockedRequests: 23
- Rule: RateLimit
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ë¹„ìš©: ë¬´ë£Œ (CloudWatch Metrics ê¸°ë³¸ ì œê³µ)
ìš©ë„: ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§, ì•ŒëŒ ì„¤ì •
```

### ğŸ¯ ìš°ë¦¬ì˜ WAF ì„¤ì •

#### 1. ALB WAF (`petclinic-dev-alb-waf`)

```hcl
Rate Limiting Rule:
- 5ë¶„ë‹¹ 2,000 ìš”ì²­ ì œí•œ
- IP ì£¼ì†Œ ê¸°ë°˜
- ì´ˆê³¼ì‹œ ì°¨ë‹¨

AWS Managed Rules:
- AWSManagedRulesCommonRuleSet
  â†³ SQL Injection ì°¨ë‹¨
  â†³ XSS (Cross-Site Scripting) ì°¨ë‹¨
  â†³ ì¼ë°˜ì ì¸ ê³µê²© íŒ¨í„´ ì°¨ë‹¨
```

#### 2. API Gateway WAF (`petclinic-dev-api-rate-limit`)

```hcl
Rate Limiting Rule:
- 5ë¶„ë‹¹ 1,000 ìš”ì²­ ì œí•œ
- IP ì£¼ì†Œ ê¸°ë°˜
- API ì—”ë“œí¬ì¸íŠ¸ ë³´í˜¸
```

### WAF ëŒ€ì‹œë³´ë“œ ë³´ê¸°

```
CloudWatch ëŒ€ì‹œë³´ë“œì—ì„œ WAF ìœ„ì ¯ ì¶”ê°€ (ì„ íƒì‚¬í•­)

Widget ì¶”ê°€:
  â†“
Metric: WAFV2
  â†“
ì„ íƒ:
- AllowedRequests
- BlockedRequests
  â†“
Graph type: Stacked area
```

**ì˜ˆìƒ ê·¸ë˜í”„:**
```
Requests
    â”‚
2000â”‚     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  Allowed
    â”‚     â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  Blocked
1500â”‚     â–ˆâ–ˆ
    â”‚     â–ˆâ–ˆ
1000â”‚     â–ˆâ–ˆ
    â”‚     â–ˆâ–ˆ
 500â”‚     â–ˆâ–ˆ
    â”‚â”€â”€â”€â”€â”€â–ˆâ–ˆâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Time
```

---

## 9. ë¬¸ì œ í•´ê²° ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ê°‘ìê¸° ì‘ë‹µ ì‹œê°„ì´ ëŠë ¤ì§

**ì¦ìƒ:**
```
ì•ŒëŒ ë°œìƒ: "petclinic-dev-alb-response-time"
í‰ê·  ì‘ë‹µ ì‹œê°„: 250ms â†’ 5,000ms (20ë°° ì¦ê°€!)
```

**ë¬¸ì œ í•´ê²° ë‹¨ê³„:**

#### Step 1: ëŒ€ì‹œë³´ë“œ í™•ì¸
```
1. CloudWatch Dashboard ì—´ê¸°
2. í™•ì¸ ì‚¬í•­:
   - ECS CPU: ì •ìƒ (40%)
   - ECS Memory: ì •ìƒ (50%)
   - RDS CPU: ë†’ìŒ! (95%) âš ï¸
   - ALB ìš”ì²­ ìˆ˜: ì •ìƒ
```

**ê²°ë¡ : DBê°€ ë³‘ëª©**

#### Step 2: RDS ë¡œê·¸ í™•ì¸
```bash
# ëŠë¦° ì¿¼ë¦¬ ë¡œê·¸ ë‹¤ìš´ë¡œë“œ
aws rds download-db-log-file-portion \
  --db-instance-identifier petclinic-dev \
  --log-file-name slowquery/mysql-slowquery.log \
  --output text
```

**ë°œê²¬:**
```sql
-- ì¸ë±ìŠ¤ ì—†ì´ LIKE ê²€ìƒ‰
Query_time: 8.543000
SELECT * FROM customers 
WHERE name LIKE '%john%'
ORDER BY created_at DESC;
```

#### Step 3: ì¦‰ì‹œ ì¡°ì¹˜ (ì‘ê¸‰ ì²˜ì¹˜)
```sql
-- 1. í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ëŠë¦° ì¿¼ë¦¬ ì¢…ë£Œ (DB ì ‘ì† í›„)
SHOW FULL PROCESSLIST;
KILL <process_id>;

-- 2. ìºì‹œ í™œìš© í™•ì¸
-- ElastiCache ì ì¤‘ë¥  ì²´í¬
```

#### Step 4: ê·¼ë³¸ í•´ê²° (ë°°í¬)
```sql
-- ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX idx_customers_name ON customers(name);

-- ì¿¼ë¦¬ ìµœì í™”
SELECT id, name, email FROM customers 
WHERE name LIKE 'john%'  -- ì•ë¶€ë¶„ ë§¤ì¹­ìœ¼ë¡œ ë³€ê²½
ORDER BY created_at DESC
LIMIT 100;
```

#### Step 5: ëª¨ë‹ˆí„°ë§
```
- RDS CPU ì‚¬ìš©ë¥  ê°ì†Œ: 95% â†’ 35%
- ì‘ë‹µ ì‹œê°„ ê°œì„ : 5,000ms â†’ 200ms
- ì•ŒëŒ í•´ì œ í™•ì¸
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: 5XX ì—ëŸ¬ ê¸‰ì¦

**ì¦ìƒ:**
```
ì•ŒëŒ ë°œìƒ: "petclinic-dev-alb-5xx-errors"
5XX ì—ëŸ¬: 0 â†’ 150ê°œ (5ë¶„ê°„)
```

**ë¬¸ì œ í•´ê²° ë‹¨ê³„:**

#### Step 1: ì—ëŸ¬ ë¡œê·¸ ê¸´ê¸‰ ì¡°íšŒ
```bash
# CloudWatch Logs Insights
aws logs start-query \
  --log-group-name /ecs/petclinic-dev-customers \
  --start-time $(date -d '10 minutes ago' +%s) \
  --end-time $(date +%s) \
  --query-string '
    fields @timestamp, @message
    | filter @message like /ERROR/
    | sort @timestamp desc
    | limit 100
  '
```

**ë°œê²¬:**
```
2024-01-15 10:45:23 ERROR Database connection pool exhausted
2024-01-15 10:45:24 ERROR Could not get JDBC Connection
2024-01-15 10:45:25 ERROR HikariPool-1 - Connection is not available
```

**ê²°ë¡ : DB ì—°ê²° í’€ ê³ ê°ˆ**

#### Step 2: RDS ì—°ê²° ìˆ˜ í™•ì¸
```bash
aws cloudwatch get-metric-statistics \
  --namespace AWS/RDS \
  --metric-name DatabaseConnections \
  --dimensions Name=DBInstanceIdentifier,Value=petclinic-dev \
  --statistics Maximum \
  --start-time $(date -u -d '1 hour ago' +%Y-%m-%dT%H:%M:%S) \
  --end-time $(date -u +%Y-%m-%dT%H:%M:%S) \
  --period 300
```

**ë°œê²¬:**
```
ìµœëŒ€ ì—°ê²° ìˆ˜: 100
í˜„ì¬ ì—°ê²°: 98 (ê±°ì˜ í•œê³„!)
```

#### Step 3: ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • í™•ì¸
```yaml
# application.yml
spring:
  datasource:
    hikari:
      maximum-pool-size: 20  # ê° ì¸ìŠ¤í„´ìŠ¤ë‹¹
      minimum-idle: 5
      connection-timeout: 30000
```

**ë¬¸ì œ ë°œê²¬:**
```
ECS ì‘ì—… ìˆ˜: 5ê°œ
ì¸ìŠ¤í„´ìŠ¤ë‹¹ ì—°ê²°: 20ê°œ
ì´ ì—°ê²° ì‚¬ìš©: 5 Ã— 20 = 100ê°œ (RDS í•œê³„)
```

#### Step 4: ì¦‰ì‹œ ì¡°ì¹˜
```bash
# 1. ECS ì‘ì—… ìˆ˜ ì¤„ì´ê¸° (ì„ì‹œ)
aws ecs update-service \
  --cluster petclinic-dev-cluster \
  --service petclinic-dev-customers-service \
  --desired-count 3  # 5 â†’ 3ìœ¼ë¡œ ê°ì†Œ

# 2. ë˜ëŠ” RDS ì—°ê²° í•œê³„ ì¦ê°€
aws rds modify-db-instance \
  --db-instance-identifier petclinic-dev \
  --max-allocated-storage 200  # íŒŒë¼ë¯¸í„° ê·¸ë£¹ì—ì„œ max_connections ì¦ê°€
```

#### Step 5: ê·¼ë³¸ í•´ê²° (ë°°í¬)
```yaml
# application.yml ìˆ˜ì •
spring:
  datasource:
    hikari:
      maximum-pool-size: 10  # 20 â†’ 10ìœ¼ë¡œ ê°ì†Œ
      minimum-idle: 2
      connection-timeout: 20000
      
# ê³„ì‚°: 5 ì‘ì—… Ã— 10 ì—°ê²° = 50 (ì—¬ìœ  ì¶©ë¶„)
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: ë©”ëª¨ë¦¬ ë¶€ì¡±ìœ¼ë¡œ ì¸í•œ ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘

**ì¦ìƒ:**
```
ì•ŒëŒ ë°œìƒ: "petclinic-dev-ecs-memory-high"
ECS ì‘ì—…ì´ ê³„ì† ì¬ì‹œì‘ë¨
```

**ë¬¸ì œ í•´ê²° ë‹¨ê³„:**

#### Step 1: Container Insights í™•ì¸
```
CloudWatch â†’ Container Insights â†’ ECS Tasks
  â†“
ì„œë¹„ìŠ¤: petclinic-dev-vets-service
  â†“
ë©”ëª¨ë¦¬ ì‚¬ìš©: 95% (limitì— ê·¼ì ‘)
```

#### Step 2: ë¡œê·¸ í™•ì¸
```bash
# ì¬ì‹œì‘ ì „ ë¡œê·¸ í™•ì¸
aws logs filter-log-events \
  --log-group-name /ecs/petclinic-dev-vets \
  --filter-pattern "OutOfMemoryError" \
  --start-time $(date -d '1 hour ago' +%s)000
```

**ë°œê²¬:**
```
2024-01-15 10:30:15 ERROR java.lang.OutOfMemoryError: Java heap space
2024-01-15 10:30:16 ERROR Unable to allocate 524288 KB
```

#### Step 3: í˜„ì¬ ë©”ëª¨ë¦¬ ì„¤ì • í™•ì¸
```hcl
# terraform/layers/07-application/main.tf
resource "aws_ecs_task_definition" "vets" {
  memory = "512"  # 512 MB (ë„ˆë¬´ ì‘ìŒ!)
  
  container_definitions = jsonencode([{
    memory = 512
    memoryReservation = 256
  }])
}
```

#### Step 4: ì¦‰ì‹œ ì¡°ì¹˜
```bash
# 1. ì‘ì—… ìˆ˜ ì¤„ì´ê¸° (ì¼ì‹œì  ë¶€í•˜ ê²½ê°)
aws ecs update-service \
  --cluster petclinic-dev-cluster \
  --service petclinic-dev-vets-service \
  --desired-count 1

# 2. ìƒˆ ì‘ì—… ì •ì˜ ë“±ë¡ (ë©”ëª¨ë¦¬ ì¦ê°€)
# Terraform ìˆ˜ì • í›„ apply
```

#### Step 5: ê·¼ë³¸ í•´ê²° (Terraform)
```hcl
# terraform/layers/07-application/main.tf ìˆ˜ì •
resource "aws_ecs_task_definition" "vets" {
  memory = "1024"  # 512 â†’ 1024 MBë¡œ ì¦ê°€
  
  container_definitions = jsonencode([{
    memory = 1024
    memoryReservation = 512
    
    # JVM í™ ë©”ëª¨ë¦¬ ì„¤ì • ì¶”ê°€
    environment = [
      {
        name  = "JAVA_OPTS"
        value = "-Xmx768m -Xms512m"  # í™ ë©”ëª¨ë¦¬ ëª…ì‹œì  ì„¤ì •
      }
    ]
  }])
}
```

```bash
# Terraform ë°°í¬
cd terraform/layers/07-application
terraform apply
```

#### Step 6: ëª¨ë‹ˆí„°ë§
```
- ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ : 95% â†’ 60%
- ì‘ì—… ì¬ì‹œì‘: ì—†ìŒ
- ì•ŒëŒ í•´ì œ
```

---

## 10. ë¹„ìš© ìµœì í™” íŒ

### í˜„ì¬ ëª¨ë‹ˆí„°ë§ ë¹„ìš© êµ¬ì¡°

```
CloudWatch ë¹„ìš© í•­ëª©:

1. ë©”íŠ¸ë¦­ (Metrics)
   - ê¸°ë³¸ ë©”íŠ¸ë¦­ (AWS ì„œë¹„ìŠ¤): ë¬´ë£Œ
   - ì‚¬ìš©ì ì •ì˜ ë©”íŠ¸ë¦­: $0.30 per metric per month
   
2. ëŒ€ì‹œë³´ë“œ (Dashboard)
   - ì²˜ìŒ 3ê°œ: ë¬´ë£Œ
   - ì¶”ê°€ ëŒ€ì‹œë³´ë“œ: $3.00 per dashboard per month
   
3. ì•ŒëŒ (Alarms)
   - í‘œì¤€ ì•ŒëŒ: $0.10 per alarm per month
   - ê³ í•´ìƒë„ ì•ŒëŒ: $0.30 per alarm per month
   
4. ë¡œê·¸ (Logs)
   - ë°ì´í„° ìˆ˜ì§‘: $0.50 per GB
   - ìŠ¤í† ë¦¬ì§€: $0.03 per GB per month
   - Logs Insights ì¿¼ë¦¬: $0.005 per GB scanned
   
5. Container Insights
   - $0.50 per task per month
```

### ğŸ“Š ìš°ë¦¬ ì‹œìŠ¤í…œ ì˜ˆìƒ ë¹„ìš©

```
í•­ëª©                    ìˆ˜ëŸ‰        ë‹¨ê°€            ì›” ë¹„ìš©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ê¸°ë³¸ ë©”íŠ¸ë¦­              N/A        ë¬´ë£Œ             $0
ëŒ€ì‹œë³´ë“œ (1ê°œ)           1          ë¬´ë£Œ             $0
ì•ŒëŒ (20ê°œ)              20         $0.10            $2.00
ë¡œê·¸ ìˆ˜ì§‘ (5 GB)         5 GB       $0.50/GB         $2.50
ë¡œê·¸ ìŠ¤í† ë¦¬ì§€ (10 GB)    10 GB      $0.03/GB         $0.30
Container Insights (6)   6 tasks    $0.50/task       $3.00
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ì´ê³„:                                                 $7.80/ì›”
```

**ì œê±°í•œ WAF ë¡œê¹… ì ˆê°:**
```
WAF ë¡œê·¸ ìˆ˜ì§‘ (100 GB):  $50.00/ì›”  â† ì ˆê°!
WAF ë¡œê·¸ ìŠ¤í† ë¦¬ì§€:       $3.00/ì›”   â† ì ˆê°!
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ì ˆê°ì•¡:                  $53.00/ì›”  (87% ì ˆê°!)
```

### ì¶”ê°€ ë¹„ìš© ìµœì í™” ì „ëµ

#### 1. ë¡œê·¸ ë³´ê´€ ê¸°ê°„ ìµœì í™”

```hcl
# terraform/modules/cloudwatch/main.tf
resource "aws_cloudwatch_log_group" "ecs_logs" {
  name              = "/ecs/petclinic-dev-customers"
  retention_in_days = 7  # 30 â†’ 7ì¼ë¡œ ë‹¨ì¶•
  
  # ë¹„ìš© ì ˆê°:
  # 30ì¼: 10 GB Ã— $0.03 Ã— 30/30 = $0.30
  # 7ì¼:  10 GB Ã— $0.03 Ã— 7/30  = $0.07
  # ì ˆê°: $0.23 per log group
}
```

**ê¶Œì¥ ë³´ê´€ ê¸°ê°„:**
- ê°œë°œ í™˜ê²½: 7ì¼
- ìŠ¤í…Œì´ì§•: 14ì¼
- í”„ë¡œë•ì…˜: 30ì¼
- ê·œì • ì¤€ìˆ˜: 90-365ì¼

#### 2. Logs Insights ì¿¼ë¦¬ ìµœì í™”

```sql
-- âŒ ë¹„íš¨ìœ¨ì  (ì „ì²´ ë¡œê·¸ ìŠ¤ìº”)
fields @timestamp, @message
| sort @timestamp desc

-- âœ… íš¨ìœ¨ì  (ì‹œê°„ ë²”ìœ„ ì œí•œ)
fields @timestamp, @message
| filter @timestamp > ago(1h)
| sort @timestamp desc
| limit 100

-- ë¹„ìš© ì°¨ì´:
-- ì „ì²´ ìŠ¤ìº”: 10 GB Ã— $0.005 = $0.05 per query
-- ì œí•œ ìŠ¤ìº”: 0.5 GB Ã— $0.005 = $0.0025 per query
```

#### 3. Container Insights ì„ íƒì  í™œì„±í™”

```hcl
# í”„ë¡œë•ì…˜ í™˜ê²½ë§Œ í™œì„±í™”
resource "aws_ecs_cluster" "main" {
  name = "${var.name_prefix}-cluster"
  
  setting {
    name  = "containerInsights"
    value = var.environment == "prod" ? "enabled" : "disabled"
  }
}

# ì ˆê° (ê°œë°œ í™˜ê²½):
# 6 tasks Ã— $0.50 = $3.00/ì›”
```

#### 4. ë©”íŠ¸ë¦­ í•´ìƒë„ ì¡°ì •

```hcl
# ëŒ€ì‹œë³´ë“œ ìœ„ì ¯ period ì¡°ì •
properties = {
  metrics = [...]
  period  = 300   # 5ë¶„ (í‘œì¤€)
  # ê³ í•´ìƒë„ (1ë¶„)ëŠ” ë¹„ìš© 3ë°°
  
  region = var.aws_region
}
```

#### 5. ë¶ˆí•„ìš”í•œ ì•ŒëŒ ì œê±°

```bash
# ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì•ŒëŒ í™•ì¸
aws cloudwatch describe-alarms --state-value INSUFFICIENT_DATA

# 6ê°œì›” ì´ìƒ ë°œìƒí•˜ì§€ ì•Šì€ ì•ŒëŒ ê²€í† 
aws cloudwatch describe-alarm-history \
  --alarm-name petclinic-dev-ecs-cpu-high \
  --history-item-type StateUpdate \
  --start-date $(date -d '6 months ago' -u +%Y-%m-%dT%H:%M:%S)
```

### ë¹„ìš© ëª¨ë‹ˆí„°ë§

```
Cost Explorerì—ì„œ CloudWatch ë¹„ìš© ì¶”ì :

AWS ì½˜ì†” â†’ Cost Management â†’ Cost Explorer
  â†“
Filter: Service = CloudWatch
  â†“
Group by: Usage Type
  â†“
ë¶„ì„:
- DataProcessing-Bytes (ë¡œê·¸ ìˆ˜ì§‘)
- StorageUsage (ë¡œê·¸ ìŠ¤í† ë¦¬ì§€)
- Requests (API í˜¸ì¶œ)
```

---

## í•™ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì´ˆê¸‰ (ê¸°ë³¸ ê°œë…)
- [ ] CloudWatch ëŒ€ì‹œë³´ë“œ ì ‘ì†í•  ìˆ˜ ìˆë‹¤
- [ ] ë©”íŠ¸ë¦­, ë¡œê·¸, ì•ŒëŒì˜ ì°¨ì´ë¥¼ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤
- [ ] ECS ì„œë¹„ìŠ¤ì˜ CPU/ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤
- [ ] ALB ìš”ì²­ ìˆ˜ì™€ ì‘ë‹µ ì‹œê°„ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤
- [ ] CloudWatch Logsì—ì„œ ë¡œê·¸ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆë‹¤

### ì¤‘ê¸‰ (ì‹¤ì „ í™œìš©)
- [ ] ì•ŒëŒ ë°œìƒ ì‹œ ì›ì¸ì„ íŒŒì•…í•  ìˆ˜ ìˆë‹¤
- [ ] Logs Insightsë¡œ ê³ ê¸‰ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤
- [ ] Container Insightsë¡œ ì‘ì—…ë³„ ë©”íŠ¸ë¦­ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤
- [ ] RDS ëŠë¦° ì¿¼ë¦¬ ë¡œê·¸ë¥¼ ë¶„ì„í•  ìˆ˜ ìˆë‹¤
- [ ] ëŒ€ì‹œë³´ë“œ ìœ„ì ¯ì„ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•  ìˆ˜ ìˆë‹¤

### ê³ ê¸‰ (ìµœì í™” & ìë™í™”)
- [ ] ë¹„ìš© íš¨ìœ¨ì ì¸ ë¡œê·¸ ë³´ê´€ ì „ëµì„ ìˆ˜ë¦½í•  ìˆ˜ ìˆë‹¤
- [ ] SNSë¥¼ í†µí•œ ì•ŒëŒ ì•Œë¦¼ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤
- [ ] Terraformìœ¼ë¡œ ëª¨ë‹ˆí„°ë§ ì„¤ì •ì„ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤
- [ ] ì„±ëŠ¥ ë¬¸ì œ ë°œìƒ ì‹œ ê·¼ë³¸ ì›ì¸ì„ ë¶„ì„í•  ìˆ˜ ìˆë‹¤
- [ ] ëª¨ë‹ˆí„°ë§ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì•„í‚¤í…ì²˜ë¥¼ ê°œì„ í•  ìˆ˜ ìˆë‹¤

---

## ì°¸ê³  ìë£Œ

### AWS ê³µì‹ ë¬¸ì„œ
- [CloudWatch ì‚¬ìš© ì„¤ëª…ì„œ](https://docs.aws.amazon.com/cloudwatch/)
- [Container Insights](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/ContainerInsights.html)
- [Logs Insights ì¿¼ë¦¬ ë¬¸ë²•](https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/CWL_QuerySyntax.html)

### ìš°ë¦¬ í”„ë¡œì íŠ¸ ë¬¸ì„œ
- `docs/ARCHITECTURE.md`: ì „ì²´ ì•„í‚¤í…ì²˜
- `docs/TO-BE-ARCHITECTURE.md`: To-Be ì•„í‚¤í…ì²˜
- `terraform/layers/07-application/monitoring.tf`: ì• í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë‹ˆí„°ë§ ì½”ë“œ
- `terraform/layers/10-monitoring/main.tf`: í†µí•© ëª¨ë‹ˆí„°ë§ ì½”ë“œ

### ìœ ìš©í•œ AWS CLI ëª…ë ¹ì–´ ëª¨ìŒ
```bash
# ëŒ€ì‹œë³´ë“œ ëª©ë¡
aws cloudwatch list-dashboards

# ì•ŒëŒ ëª©ë¡ (ìƒíƒœë³„)
aws cloudwatch describe-alarms --state-value ALARM

# ë©”íŠ¸ë¦­ í†µê³„ ì¡°íšŒ
aws cloudwatch get-metric-statistics \
  --namespace AWS/ECS \
  --metric-name CPUUtilization \
  --dimensions Name=ServiceName,Value=petclinic-dev-customers-service \
              Name=ClusterName,Value=petclinic-dev-cluster \
  --statistics Average \
  --start-time $(date -u -d '1 hour ago' +%Y-%m-%dT%H:%M:%S) \
  --end-time $(date -u +%Y-%m-%dT%H:%M:%S) \
  --period 300

# ë¡œê·¸ ê·¸ë£¹ ëª©ë¡
aws logs describe-log-groups --log-group-name-prefix "/ecs/petclinic"

# ë¡œê·¸ tail (ì‹¤ì‹œê°„)
aws logs tail /ecs/petclinic-dev-customers --follow

# Logs Insights ì¿¼ë¦¬ ì‹¤í–‰
aws logs start-query \
  --log-group-name /ecs/petclinic-dev-customers \
  --start-time $(date -d '1 hour ago' +%s) \
  --end-time $(date +%s) \
  --query-string 'fields @timestamp, @message | filter @message like /ERROR/'
```

---

## ë‹¤ìŒ ë‹¨ê³„

ëª¨ë‹ˆí„°ë§ì„ ë°°ì› ë‹¤ë©´ ë‹¤ìŒì„ í•™ìŠµí•˜ì„¸ìš”:

1. **íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ì‹¬í™”**
   - X-Rayë¥¼ í™œìš©í•œ ë¶„ì‚° ì¶”ì 
   - APM ë„êµ¬ í†µí•© (New Relic, Datadog)

2. **ìë™í™”**
   - Lambdaë¥¼ í™œìš©í•œ ìë™ ë³µêµ¬
   - Auto Scaling ì •ì±… ìµœì í™”

3. **ë³´ì•ˆ ëª¨ë‹ˆí„°ë§**
   - GuardDuty ìœ„í˜‘ íƒì§€
   - Security Hub í†µí•©

4. **ë¹„ìš© ìµœì í™”**
   - Cost Anomaly Detection
   - Savings Plans í™œìš©
