# 01-network ë ˆì´ì–´ ğŸ“¡

## ëª©ì°¨
- [ê°œìš”](#ê°œìš”)
- [AWS ë„¤íŠ¸ì›Œí¬ ê¸°ì´ˆ ê°œë…](#aws-ë„¤íŠ¸ì›Œí¬-ê¸°ì´ˆ-ê°œë…)
- [ìš°ë¦¬ê°€ ë§Œë“œëŠ” ë„¤íŠ¸ì›Œí¬ êµ¬ì¡°](#ìš°ë¦¬ê°€-ë§Œë“œëŠ”-ë„¤íŠ¸ì›Œí¬-êµ¬ì¡°)
- [ë„¤íŠ¸ì›Œí¬ ê²½ë¡œ ì„¤ëª…](#ë„¤íŠ¸ì›Œí¬-ê²½ë¡œ-ì„¤ëª…)
- [ì½”ë“œ êµ¬ì¡°](#ì½”ë“œ-êµ¬ì¡°)
- [ë°°í¬ ë°©ë²•](#ë°°í¬-ë°©ë²•)
- [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)

---

## ê°œìš”

**01-network ë ˆì´ì–´**ëŠ” ì „ì²´ ì¸í”„ë¼ì˜ **ê¸°ë°˜ì´ ë˜ëŠ” ë„¤íŠ¸ì›Œí¬**ë¥¼ êµ¬ì¶•í•©ë‹ˆë‹¤. 
ì§‘ì„ ì§“ëŠ”ë‹¤ë©´ ê°€ì¥ ë¨¼ì € ë•…ê³¼ ê¸°ì´ˆê³µì‚¬ë¥¼ í•˜ëŠ” ê²ƒì²˜ëŸ¼, AWSì—ì„œë„ ê°€ì¥ ë¨¼ì € VPC(Virtual Private Cloud)ì™€ ì„œë¸Œë„·ì„ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.

### ì´ ë ˆì´ì–´ê°€ í•˜ëŠ” ì¼
- âœ… VPC (ê°€ìƒ ë„¤íŠ¸ì›Œí¬) ìƒì„±
- âœ… Public/Private ì„œë¸Œë„· ìƒì„±
- âœ… NAT Gateway ì„¤ì • (í”„ë¼ì´ë¹— ì„œë¸Œë„·ì˜ ì¸í„°ë„· ì ‘ê·¼)
- âœ… VPC ì—”ë“œí¬ì¸íŠ¸ ì„¤ì • (AWS ì„œë¹„ìŠ¤ í”„ë¼ì´ë¹— ì ‘ê·¼)
- âœ… ë¼ìš°íŒ… í…Œì´ë¸” êµ¬ì„±

### ë‹¤ë¥¸ ë ˆì´ì–´ì™€ì˜ ê´€ê³„
```
01-network (ì´ ë ˆì´ì–´) ğŸ—ï¸
    â†“
    â”œâ”€â†’ 02-security (ë³´ì•ˆ ê·¸ë£¹)
    â”œâ”€â†’ 03-ecs-cluster (ì»¨í…Œì´ë„ˆ í´ëŸ¬ìŠ¤í„°)
    â”œâ”€â†’ 04-database (ë°ì´í„°ë² ì´ìŠ¤)
    â””â”€â†’ 07-application (ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤)
```

ëª¨ë“  ìƒìœ„ ë ˆì´ì–´ëŠ” ì´ ë„¤íŠ¸ì›Œí¬ ìœ„ì—ì„œ ë™ì‘í•©ë‹ˆë‹¤.

---

## AWS ë„¤íŠ¸ì›Œí¬ ê¸°ì´ˆ ê°œë…

### 1. VPC (Virtual Private Cloud) ğŸ¢

**ì‰½ê²Œ ì„¤ëª…**: VPCëŠ” AWS í´ë¼ìš°ë“œì—ì„œ **ë‚˜ë§Œì˜ ë…ë¦½ëœ ë„¤íŠ¸ì›Œí¬ ê³µê°„**ì…ë‹ˆë‹¤.

- ì•„íŒŒíŠ¸ ë‹¨ì§€ ì „ì²´ë¼ê³  ìƒê°í•˜ë©´ ë©ë‹ˆë‹¤
- IP ì£¼ì†Œ ë²”ìœ„(CIDR)ë¥¼ ì§€ì •í•´ì„œ ìƒì„±í•©ë‹ˆë‹¤
- ì˜ˆ: `10.0.0.0/16` = 10.0.0.0 ~ 10.0.255.255 (65,536ê°œ IP)

**ìš°ë¦¬ í”„ë¡œì íŠ¸**: `10.0.0.0/16` ë²”ìœ„ì˜ VPC 1ê°œ ìƒì„±

```
VPC: 10.0.0.0/16
â”œâ”€ ì‚¬ìš© ê°€ëŠ¥í•œ IP: 65,536ê°œ
â”œâ”€ ë¦¬ì „: us-west-2 (ì˜¤ë ˆê³¤)
â””â”€ ê°€ìš© ì˜ì—­: 2ê°œ ì‚¬ìš© (us-west-2a, us-west-2b)
```

---

### 2. ì„œë¸Œë„· (Subnet) ğŸ˜ï¸

**ì‰½ê²Œ ì„¤ëª…**: ì„œë¸Œë„·ì€ VPCë¥¼ **ì‘ì€ êµ¬ì—­ìœ¼ë¡œ ë‚˜ëˆˆ ê²ƒ**ì…ë‹ˆë‹¤.

ì•„íŒŒíŠ¸ ë‹¨ì§€(VPC) ì•ˆì— ì—¬ëŸ¬ ë™(ì„œë¸Œë„·)ì´ ìˆëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤.

#### ì„œë¸Œë„· ì¢…ë¥˜

| íƒ€ì… | ìš©ë„ | ì¸í„°ë„· ì ‘ê·¼ | ì˜ˆì‹œ |
|------|------|-------------|------|
| **Public Subnet** | ì™¸ë¶€ ì ‘ê·¼ í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ | âœ… ì§ì ‘ ê°€ëŠ¥ | ALB, Bastion |
| **Private App Subnet** | ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ | âš ï¸ NAT Gateway ê²½ìœ  | ECS ì»¨í…Œì´ë„ˆ |
| **Private DB Subnet** | ë°ì´í„°ë² ì´ìŠ¤ | âŒ ë¶ˆê°€ëŠ¥ | Aurora DB |

**ìš°ë¦¬ í”„ë¡œì íŠ¸**: ê° ê°€ìš©ì˜ì—­ë§ˆë‹¤ 3ì¢…ë¥˜ ì„œë¸Œë„· ìƒì„± (ì´ 6ê°œ)

```
ê°€ìš©ì˜ì—­ A (us-west-2a)              ê°€ìš©ì˜ì—­ B (us-west-2b)
â”œâ”€ Public:      10.0.0.0/24        â”œâ”€ Public:      10.0.1.0/24
â”œâ”€ Private App: 10.0.10.0/24       â”œâ”€ Private App: 10.0.11.0/24
â””â”€ Private DB:  10.0.20.0/24       â””â”€ Private DB:  10.0.21.0/24
```

---

### 3. ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ (Internet Gateway) ğŸšª

**ì‰½ê²Œ ì„¤ëª…**: VPCì™€ ì¸í„°ë„·ì„ ì—°ê²°í•˜ëŠ” **ëŒ€ë¬¸**ì…ë‹ˆë‹¤.

- Public ì„œë¸Œë„·ì˜ ë¦¬ì†ŒìŠ¤ê°€ ì¸í„°ë„·ê³¼ í†µì‹ í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤
- VPCë‹¹ 1ê°œë§Œ í•„ìš”í•©ë‹ˆë‹¤

```
ì¸í„°ë„· â†” [Internet Gateway] â†” Public Subnet
```

---

### 4. NAT ê²Œì´íŠ¸ì›¨ì´ (NAT Gateway) ğŸ”„

**ì‰½ê²Œ ì„¤ëª…**: Private ì„œë¸Œë„·ì´ **ì¼ë°©í–¥ìœ¼ë¡œë§Œ ì¸í„°ë„·ì— ì ‘ê·¼**í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ì¥ì¹˜ì…ë‹ˆë‹¤.

#### NAT Gatewayê°€ í•„ìš”í•œ ì´ìœ 

Private ì„œë¸Œë„·ì˜ ECS ì»¨í…Œì´ë„ˆëŠ”:
- âœ… ì™¸ë¶€ë¡œ ë‚˜ê°€ì•¼ í•¨ (Docker ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ, API í˜¸ì¶œ ë“±)
- âŒ ì™¸ë¶€ì—ì„œ ë“¤ì–´ì˜¤ë©´ ì•ˆ ë¨ (ë³´ì•ˆ)

NAT GatewayëŠ” **ë‚˜ê°€ëŠ” ê²ƒë§Œ í—ˆìš©**í•˜ê³ , ì™¸ë¶€ì—ì„œ ë“¤ì–´ì˜¤ëŠ” ì—°ê²°ì€ ì°¨ë‹¨í•©ë‹ˆë‹¤.

```
Private Subnet (ECS) â†’ NAT Gateway â†’ Internet Gateway â†’ ì¸í„°ë„·
ì¸í„°ë„· âœ—â†’ NAT Gateway âœ—â†’ Private Subnet (ì°¨ë‹¨ë¨)
```

**ë¹„ìš© ìµœì í™”**:
- NAT GatewayëŠ” ë¹„ìŒ‰ë‹ˆë‹¤ ($30-40/ì›”)
- ìš°ë¦¬ í”„ë¡œì íŠ¸: 1ê°œë§Œ ì‚¬ìš© (ëª¨ë“  AZê°€ ê³µìœ )
- ê³ ê°€ìš©ì„± í•„ìš” ì‹œ: AZë§ˆë‹¤ 1ê°œì”© (`create_nat_per_az = true`)

---

### 5. ë¼ìš°íŒ… í…Œì´ë¸” (Route Table) ğŸ—ºï¸

**ì‰½ê²Œ ì„¤ëª…**: ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì˜ **êµí†µ í‘œì§€íŒ**ì…ë‹ˆë‹¤.

ê° ì„œë¸Œë„·ë§ˆë‹¤ "ì–´ë””ë¡œ ê°€ëŠ” íŠ¸ë˜í”½ì„ ì–´ëŠ ê²½ë¡œë¡œ ë³´ë‚¼ì§€" ì •ì˜í•©ë‹ˆë‹¤.

#### Public ì„œë¸Œë„· ë¼ìš°íŒ…
```
ëª©ì ì§€              ë‹¤ìŒ ê²½ë¡œ
10.0.0.0/16   â†’    local (VPC ë‚´ë¶€)
0.0.0.0/0     â†’    Internet Gateway (ëª¨ë“  ì™¸ë¶€ íŠ¸ë˜í”½)
```

#### Private App ì„œë¸Œë„· ë¼ìš°íŒ…
```
ëª©ì ì§€              ë‹¤ìŒ ê²½ë¡œ
10.0.0.0/16   â†’    local (VPC ë‚´ë¶€)
0.0.0.0/0     â†’    NAT Gateway (ì™¸ë¶€ íŠ¸ë˜í”½)
```

#### Private DB ì„œë¸Œë„· ë¼ìš°íŒ…
```
ëª©ì ì§€              ë‹¤ìŒ ê²½ë¡œ
10.0.0.0/16   â†’    local (VPC ë‚´ë¶€ë§Œ)
```

---

### 6. VPC ì—”ë“œí¬ì¸íŠ¸ (VPC Endpoint) ğŸ”

**ì‰½ê²Œ ì„¤ëª…**: AWS ì„œë¹„ìŠ¤ë¥¼ **ì¸í„°ë„·ì„ ê±°ì¹˜ì§€ ì•Šê³  í”„ë¼ì´ë¹—í•˜ê²Œ** ì ‘ê·¼í•˜ëŠ” í†µë¡œì…ë‹ˆë‹¤.

#### VPC ì—”ë“œí¬ì¸íŠ¸ê°€ í•„ìš”í•œ ì´ìœ 

ì˜ˆë¥¼ ë“¤ì–´, Private ì„œë¸Œë„·ì˜ ECS ì»¨í…Œì´ë„ˆê°€ ECR(Docker ë ˆì§€ìŠ¤íŠ¸ë¦¬)ì—ì„œ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¨ë‹¤ë©´:

**VPC ì—”ë“œí¬ì¸íŠ¸ ì—†ì´**:
```
ECS â†’ NAT Gateway â†’ Internet â†’ ECR
- ë¹„ìš©: NAT Gateway ë°ì´í„° ì „ì†¡ ìš”ê¸ˆ ($0.045/GB)
- ì†ë„: ëŠë¦¼ (ì¸í„°ë„· ê²½ìœ )
- ë³´ì•ˆ: ê³µìš© ì¸í„°ë„· ë…¸ì¶œ
```

**VPC ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©**:
```
ECS â†’ VPC Endpoint â†’ ECR
- ë¹„ìš©: ì €ë ´ ($0.01/GB)
- ì†ë„: ë¹ ë¦„ (AWS ë‚´ë¶€ë§)
- ë³´ì•ˆ: ì™„ì „ í”„ë¼ì´ë¹—
```

#### ìš°ë¦¬ê°€ ìƒì„±í•˜ëŠ” VPC ì—”ë“œí¬ì¸íŠ¸

| ì„œë¹„ìŠ¤ | íƒ€ì… | ìš©ë„ |
|--------|------|------|
| **S3** | Gateway | ECS ì´ë¯¸ì§€ ë ˆì´ì–´ ì €ì¥ |
| **ECR API** | Interface | ECR ë ˆì§€ìŠ¤íŠ¸ë¦¬ API |
| **ECR DKR** | Interface | Docker ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ |
| **CloudWatch Logs** | Interface | ë¡œê·¸ ì „ì†¡ |
| **Secrets Manager** | Interface | DB ë¹„ë°€ë²ˆí˜¸ ì¡°íšŒ |
| **SSM** | Interface | Parameter Store ì ‘ê·¼ |
| **KMS** | Interface | ì•”í˜¸í™” í‚¤ ê´€ë¦¬ |

**ë¹„ìš©**: Interface Endpoint $7/ì›”, Gateway Endpoint ë¬´ë£Œ

---

## ìš°ë¦¬ê°€ ë§Œë“œëŠ” ë„¤íŠ¸ì›Œí¬ êµ¬ì¡°

### ì „ì²´ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VPC: 10.0.0.0/16 (petclinic)                     â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Internet Gateway (ì™¸ë¶€ ì¸í„°ë„· ì—°ê²°)               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                       â”‚                                             â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•§â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘         ê°€ìš©ì˜ì—­ A (us-west-2a)                               â•‘  â”‚
â”‚  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£  â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘  â”‚
â”‚  â•‘  â”‚  Public Subnet (10.0.0.0/24)                        â”‚     â•‘  â”‚
â”‚  â•‘  â”‚  - ALB (Application Load Balancer)                  â”‚     â•‘  â”‚
â”‚  â•‘  â”‚  - NAT Gateway â”€â”€â†’ Elastic IP                      â”‚     â•‘  â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘  â”‚
â”‚  â•‘           â”‚                                                   â•‘  â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â•‘  â”‚
â”‚  â•‘  â”‚  Private App Subnet (10.0.10.0/24)               â”‚       â•‘  â”‚
â”‚  â•‘  â”‚  - ECS Fargate ì»¨í…Œì´ë„ˆ (Spring ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤)   â”‚       â•‘  â”‚
â”‚  â•‘  â”‚  - Lambda í•¨ìˆ˜                                    â”‚       â•‘  â”‚
â”‚  â•‘  â”‚  [VPC Endpoints: ECR, Logs, Secrets Manager]     â”‚       â•‘  â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â•‘  â”‚
â”‚  â•‘           â”‚                                                   â•‘  â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â•‘  â”‚
â”‚  â•‘  â”‚  Private DB Subnet (10.0.20.0/24)                â”‚       â•‘  â”‚
â”‚  â•‘  â”‚  - Aurora PostgreSQL (Primary)                   â”‚       â•‘  â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                     â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘         ê°€ìš©ì˜ì—­ B (us-west-2b)                               â•‘  â”‚
â”‚  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£  â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘  â”‚
â”‚  â•‘  â”‚  Public Subnet (10.0.1.0/24)                        â”‚     â•‘  â”‚
â”‚  â•‘  â”‚  - ALB (ë‹¤ì¤‘í™”)                                      â”‚     â•‘  â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘  â”‚
â”‚  â•‘           â”‚                                                   â•‘  â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â•‘  â”‚
â”‚  â•‘  â”‚  Private App Subnet (10.0.11.0/24)               â”‚       â•‘  â”‚
â”‚  â•‘  â”‚  - ECS Fargate ì»¨í…Œì´ë„ˆ (ë³µì œë³¸)                  â”‚       â•‘  â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â•‘  â”‚
â”‚  â•‘           â”‚                                                   â•‘  â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â•‘  â”‚
â”‚  â•‘  â”‚  Private DB Subnet (10.0.21.0/24)                â”‚       â•‘  â”‚
â”‚  â•‘  â”‚  - Aurora PostgreSQL (Replica - Read Only)       â”‚       â•‘  â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### IP ì£¼ì†Œ í• ë‹¹ ì „ëµ

| ì„œë¸Œë„· íƒ€ì… | AZ-A | AZ-B | ì‚¬ìš© ê°€ëŠ¥ IP | ìš©ë„ |
|-------------|------|------|--------------|------|
| Public | 10.0.0.0/24 | 10.0.1.0/24 | ê° 251ê°œ | ALB, NAT GW |
| Private App | 10.0.10.0/24 | 10.0.11.0/24 | ê° 251ê°œ | ECS, Lambda |
| Private DB | 10.0.20.0/24 | 10.0.21.0/24 | ê° 251ê°œ | Aurora DB |

**ì£¼ì˜**: AWSëŠ” ê° ì„œë¸Œë„·ì—ì„œ 5ê°œ IPë¥¼ ì˜ˆì•½í•©ë‹ˆë‹¤ (.0, .1, .2, .3, .255)

---

## ë„¤íŠ¸ì›Œí¬ ê²½ë¡œ ì„¤ëª…

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì™¸ë¶€ ì‚¬ìš©ìê°€ ì›¹ì‚¬ì´íŠ¸ ì ‘ì† ğŸŒ

```
1. ì‚¬ìš©ì ë¸Œë¼ìš°ì €
   â†“
2. Internet Gateway (VPC ì…êµ¬)
   â†“
3. Public Subnetì˜ ALB (ë¡œë“œë°¸ëŸ°ì„œ)
   â†“
4. Private App Subnetì˜ ECS ì»¨í…Œì´ë„ˆ (api-gateway, customers-service ë“±)
   â†“
5. Private DB Subnetì˜ Aurora ë°ì´í„°ë² ì´ìŠ¤

ì‘ë‹µì€ ì—­ìˆœìœ¼ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.
```

**ë³´ì•ˆ í¬ì¸íŠ¸**:
- ECS ì»¨í…Œì´ë„ˆëŠ” Private ì„œë¸Œë„·ì— ìˆì–´ì„œ ì™¸ë¶€ì—ì„œ ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€
- ì˜¤ì§ ALBë¥¼ í†µí•´ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: ECS ì»¨í…Œì´ë„ˆê°€ Docker ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ğŸ³

```
1. ECS ì»¨í…Œì´ë„ˆ (Private App Subnet)
   â†“
2. VPC Endpoint (ECR.DKR) - AWS ë‚´ë¶€ë§ìœ¼ë¡œ í”„ë¼ì´ë¹— ì ‘ê·¼
   â†“
3. ECR (Elastic Container Registry)
   â†“
4. ì´ë¯¸ì§€ ë ˆì´ì–´ëŠ” S3 Gateway Endpointë¥¼ í†µí•´ S3ì—ì„œ ë‹¤ìš´ë¡œë“œ
```

**ì¥ì **:
- NAT Gateway ë¹„ìš© ì ˆê° (ì¸í„°ë„· ê²½ìœ  ì•ˆ í•¨)
- ë¹ ë¥¸ ì†ë„ (AWS ë‚´ë¶€ë§)
- ë³´ì•ˆ ê°•í™” (ì¸í„°ë„· ë…¸ì¶œ ì—†ìŒ)

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: ECS ì»¨í…Œì´ë„ˆê°€ ì™¸ë¶€ API í˜¸ì¶œ ğŸ“¡

```
1. ECS ì»¨í…Œì´ë„ˆ (Private App Subnet)
   â†“
2. Private App Route Table í™•ì¸
   â†“
3. NAT Gateway (Public Subnet)
   â†“
4. Internet Gateway
   â†“
5. ì™¸ë¶€ API (ì˜ˆ: ë‚ ì”¨ API, ê²°ì œ API ë“±)
```

**ë™ì‘ ì›ë¦¬**:
- NAT GatewayëŠ” ì†¡ì‹ (outbound)ë§Œ í—ˆìš©
- ì™¸ë¶€ì—ì„œ ë“¤ì–´ì˜¤ëŠ” ì—°ê²°(inbound)ì€ ì°¨ë‹¨
- ì‘ë‹µì€ ê¸°ì¡´ ì—°ê²°ì„ í†µí•´ì„œë§Œ ë“¤ì–´ì˜´

---

### ì‹œë‚˜ë¦¬ì˜¤ 4: ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸ ì¡°íšŒ ğŸ”

```
1. ECS ì»¨í…Œì´ë„ˆ ì‹œì‘ ì‹œ
   â†“
2. VPC Endpoint (Secrets Manager) - í”„ë¼ì´ë¹— ì ‘ê·¼
   â†“
3. AWS Secrets Manager
   â†“
4. ì•”í˜¸í™”ëœ DB ë¹„ë°€ë²ˆí˜¸ ë°˜í™˜
   â†“
5. ECS ì»¨í…Œì´ë„ˆê°€ ë¹„ë°€ë²ˆí˜¸ë¡œ DB ì—°ê²°
```

**ë³´ì•ˆ í¬ì¸íŠ¸**:
- ë¹„ë°€ë²ˆí˜¸ê°€ ì¸í„°ë„·ì„ ê±°ì¹˜ì§€ ì•ŠìŒ
- í™˜ê²½ë³€ìˆ˜ì— í‰ë¬¸ ì €ì¥ ì•ˆ í•¨
- KMSë¡œ ì•”í˜¸í™”ë¨

---

## ì½”ë“œ êµ¬ì¡°

### íŒŒì¼ êµ¬ì„±

```
01-network/
â”œâ”€â”€ main.tf              # ë©”ì¸ êµ¬ì„± (VPC, ì„œë¸Œë„·, ì—”ë“œí¬ì¸íŠ¸)
â”œâ”€â”€ variables.tf         # ë³€ìˆ˜ ì •ì˜
â”œâ”€â”€ outputs.tf           # ì¶œë ¥ê°’ (ë‹¤ë¥¸ ë ˆì´ì–´ì—ì„œ ì‚¬ìš©)
â”œâ”€â”€ backend.tf           # Terraform ìƒíƒœ ì €ì¥ ì„¤ì •
â”œâ”€â”€ backend.config       # ë°±ì—”ë“œ í‚¤ ì„¤ì •
â”œâ”€â”€ terraform.tfvars     # ì‹¤ì œ ê°’ ì…ë ¥
â””â”€â”€ README.md            # ì´ ë¬¸ì„œ
```

### main.tf ì£¼ìš” êµ¬ì„±

```hcl
# 1. ê³µí†µ ëª¨ë“ˆ (íƒœê·¸, ì´ë¦„ ë“±)
module "common" {
  source = "../../modules/common"
  # ...
}

# 2. VPC ë° ì„œë¸Œë„·
module "vpc" {
  source = "../../modules/vpc"
  
  vpc_cidr    = "10.0.0.0/16"
  azs         = ["us-west-2a", "us-west-2b"]
  
  public_subnet_cidrs      = ["10.0.0.0/24", "10.0.1.0/24"]
  private_app_subnet_cidrs = ["10.0.10.0/24", "10.0.11.0/24"]
  private_db_subnet_cidrs  = ["10.0.20.0/24", "10.0.21.0/24"]
  
  create_nat_per_az = false  # NAT Gateway 1ê°œë§Œ ì‚¬ìš©
}

# 3. VPC ì—”ë“œí¬ì¸íŠ¸
module "vpc_endpoints" {
  source = "../../modules/endpoints"
  
  vpc_id   = module.vpc.vpc_id
  vpc_cidr = "10.0.0.0/16"
  
  interface_services = [
    "ecr.api",
    "ecr.dkr",
    "logs",
    "secretsmanager",
    "ssm",
    "kms"
  ]
}
```

### terraform.tfvars ì˜ˆì‹œ

```hcl
# ê³µí†µ ì„¤ì •
name_prefix = "petclinic"
environment = "dev"
aws_region  = "us-west-2"
aws_profile = "default"

# VPC CIDR
vpc_cidr = "10.0.0.0/16"

# ê°€ìš© ì˜ì—­
azs = ["us-west-2a", "us-west-2b"]

# ì„œë¸Œë„· CIDR
public_subnet_cidrs      = ["10.0.0.0/24", "10.0.1.0/24"]
private_app_subnet_cidrs = ["10.0.10.0/24", "10.0.11.0/24"]
private_db_subnet_cidrs  = ["10.0.20.0/24", "10.0.21.0/24"]

# VPC ì—”ë“œí¬ì¸íŠ¸
vpc_endpoint_services = [
  "ecr.api",
  "ecr.dkr",
  "logs",
  "secretsmanager",
  "ssm",
  "kms",
  "monitoring"
]

# ë¹„ìš© ìµœì í™”
create_nat_per_az = false  # NAT Gateway 1ê°œë§Œ
enable_ipv6       = false  # IPv6 ë¹„í™œì„±í™”

# íƒœê·¸
tags = {
  Project     = "petclinic"
  Environment = "dev"
  ManagedBy   = "terraform"
}
```

---

## ë°°í¬ ë°©ë²•

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­

1. **Terraform ì„¤ì¹˜** (1.0 ì´ìƒ)
```bash
terraform version
# Terraform v1.5.0 ì´ìƒ í™•ì¸
```

2. **AWS CLI ì„¤ì •**
```bash
aws configure
# AWS Access Key ID, Secret, Region ì„¤ì •
```

3. **S3 ë°±ì—”ë“œ ë²„í‚· ìƒì„±** (ìµœì´ˆ 1íšŒë§Œ)
```bash
aws s3 mb s3://petclinic-tfstate-oregon-dev --region us-west-2
```

---

### ë°°í¬ ìˆœì„œ (ì´ˆë³´ììš©)

#### 1ë‹¨ê³„: ì‘ì—… ë””ë ‰í† ë¦¬ ì´ë™
```bash
cd terraform/layers/01-network
```

#### 2ë‹¨ê³„: ë³€ìˆ˜ íŒŒì¼ í™•ì¸
```bash
cat terraform.tfvars
# VPC CIDR, ì„œë¸Œë„· CIDR ë“±ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
```

#### 3ë‹¨ê³„: Terraform ì´ˆê¸°í™”
```bash
terraform init \
  -backend-config=../../backend.hcl \
  -backend-config=backend.config
```

**ì„¤ëª…**:
- `backend.hcl`: S3 ë²„í‚· ì´ë¦„, ë¦¬ì „ ë“±
- `backend.config`: ìƒíƒœ íŒŒì¼ í‚¤ (key = "network/terraform.tfstate")

#### 4ë‹¨ê³„: ì‹¤í–‰ ê³„íš í™•ì¸ (ì¤‘ìš”!)
```bash
terraform plan -var-file=terraform.tfvars
```

**í™•ì¸ì‚¬í•­**:
- ìƒì„±ë  ë¦¬ì†ŒìŠ¤ ê°œìˆ˜ (ì•½ 30-40ê°œ)
- VPC CIDR ì£¼ì†Œ
- ì„œë¸Œë„· ê°œìˆ˜ (6ê°œ: Public 2, Private App 2, Private DB 2)
- NAT Gateway ê°œìˆ˜ (1ê°œ ë˜ëŠ” 2ê°œ)
- VPC ì—”ë“œí¬ì¸íŠ¸ ê°œìˆ˜

#### 5ë‹¨ê³„: ë°°í¬ ì‹¤í–‰
```bash
terraform apply -var-file=terraform.tfvars
```

**ì†Œìš” ì‹œê°„**: ì•½ 3-5ë¶„
- VPC, ì„œë¸Œë„·: ì¦‰ì‹œ
- NAT Gateway: 2-3ë¶„
- VPC ì—”ë“œí¬ì¸íŠ¸: 1-2ë¶„

#### 6ë‹¨ê³„: ë°°í¬ í™•ì¸
```bash
# VPC ID í™•ì¸
terraform output vpc_id

# ì„œë¸Œë„· ID í™•ì¸
terraform output public_subnet_ids
terraform output private_app_subnet_ids

# NAT Gateway ID í™•ì¸
terraform output nat_gateway_ids
```

**AWS Consoleì—ì„œ í™•ì¸**:
1. VPC ëŒ€ì‹œë³´ë“œ â†’ "Your VPCs"
2. ì´ë¦„: `petclinic-dev-vpc`
3. CIDR: `10.0.0.0/16`

---

### ë¹„ìš© ì˜ˆìƒ

| ë¦¬ì†ŒìŠ¤ | ìˆ˜ëŸ‰ | ì›” ë¹„ìš© (USD) | ì—° ë¹„ìš© (USD) |
|--------|------|---------------|---------------|
| VPC | 1 | $0 | $0 |
| Internet Gateway | 1 | $0 | $0 |
| NAT Gateway | 1 | $32 | $384 |
| Elastic IP (NATìš©) | 1 | $3.6 | $43 |
| VPC Interface Endpoint | 7ê°œ | $49 | $588 |
| S3 Gateway Endpoint | 1 | $0 | $0 |
| **í•©ê³„** | - | **$85** | **$1,015** |

**ë¹„ìš© ìµœì í™” íŒ**:
- NAT Gatewayë¥¼ 1ê°œë§Œ ì‚¬ìš© (AZë‹¹ 1ê°œ ëŒ€ì‹ )
- ê°œë°œ í™˜ê²½ì—ì„œëŠ” í•„ìš” ì—†ì„ ë•Œ ì‚­ì œ
- VPC ì—”ë“œí¬ì¸íŠ¸ëŠ” í•„ìˆ˜ í•­ëª©ë§Œ í™œì„±í™”

---

## ë¬¸ì œ í•´ê²°

### ë¬¸ì œ 1: NAT Gateway ìƒì„± ì‹¤íŒ¨
```
Error: Error creating NAT Gateway: InvalidAllocationID.NotFound
```

**ì›ì¸**: Elastic IPê°€ ë¯¸ë¦¬ ìƒì„±ë˜ì§€ ì•ŠìŒ

**í•´ê²°**:
```bash
terraform destroy -target=aws_nat_gateway.this
terraform apply -var-file=terraform.tfvars
```

---

### ë¬¸ì œ 2: VPC ì—”ë“œí¬ì¸íŠ¸ ì—°ê²° ì˜¤ë¥˜
```
Error: Error creating VPC Endpoint: InvalidParameter
```

**ì›ì¸**: ì„œë¸Œë„·ì´ë‚˜ ë³´ì•ˆ ê·¸ë£¹ ì„¤ì • ì˜¤ë¥˜

**í™•ì¸**:
```bash
# ì„œë¸Œë„· ID í™•ì¸
terraform output private_app_subnet_ids

# ë³´ì•ˆ ê·¸ë£¹ í™•ì¸
terraform state show module.vpc_endpoints.aws_security_group.vpce
```

---

### ë¬¸ì œ 3: CIDR ë¸”ë¡ ì¶©ëŒ
```
Error: InvalidVpcCidrBlock: The CIDR '10.0.0.0/16' conflicts with...
```

**ì›ì¸**: ê¸°ì¡´ VPCì™€ IP ë²”ìœ„ê°€ ê²¹ì¹¨

**í•´ê²°**: terraform.tfvarsì—ì„œ ë‹¤ë¥¸ CIDR ì‚¬ìš©
```hcl
vpc_cidr = "10.1.0.0/16"  # ë³€ê²½
```

---

### ë¬¸ì œ 4: ìƒíƒœ íŒŒì¼ ì ê¹€
```
Error: Error acquiring the state lock
```

**ì›ì¸**: ë‹¤ë¥¸ ì‚¬ëŒì´ ë™ì‹œì— terraform apply ì‹¤í–‰ ì¤‘

**í•´ê²°**:
```bash
# S3 ë„¤ì´í‹°ë¸Œ ì ê¸ˆì€ ìë™ìœ¼ë¡œ í•´ì œë˜ì§€ë§Œ, ê°•ì œ í•´ì œê°€ í•„ìš”í•˜ë©´:
terraform force-unlock <LOCK_ID>
```

---

### ë””ë²„ê¹… ëª…ë ¹ì–´

```bash
# í˜„ì¬ ìƒíƒœ í™•ì¸
terraform state list

# íŠ¹ì • ë¦¬ì†ŒìŠ¤ ìƒì„¸ ì •ë³´
terraform state show module.vpc.aws_vpc.this

# ì¶œë ¥ê°’ í™•ì¸
terraform output

# ë¦¬ì†ŒìŠ¤ ì˜ì¡´ì„± ê·¸ë˜í”„ ìƒì„±
terraform graph | dot -Tpng > graph.png
```

---

## ì¶”ê°€ í•™ìŠµ ìë£Œ

### AWS ê³µì‹ ë¬¸ì„œ
- [VPC ì‚¬ìš©ì ê°€ì´ë“œ](https://docs.aws.amazon.com/vpc/latest/userguide/)
- [NAT Gateway](https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html)
- [VPC ì—”ë“œí¬ì¸íŠ¸](https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints.html)

### Terraform ê³µì‹ ë¬¸ì„œ
- [AWS Provider](https://registry.terraform.io/providers/hashicorp/aws/latest/docs)
- [VPC Module](https://registry.terraform.io/modules/terraform-aws-modules/vpc/aws/latest)

---

## ë‹¤ìŒ ë‹¨ê³„

ë„¤íŠ¸ì›Œí¬ ë ˆì´ì–´ ë°°í¬ê°€ ì™„ë£Œë˜ë©´ ë‹¤ìŒ ë ˆì´ì–´ë¥¼ ë°°í¬í•˜ì„¸ìš”:

1. **02-security**: ë³´ì•ˆ ê·¸ë£¹ ë° IAM ì—­í• 
2. **03-ecs-cluster**: ECS í´ëŸ¬ìŠ¤í„° ìƒì„±
3. **04-database**: Aurora PostgreSQL ë°ì´í„°ë² ì´ìŠ¤

```bash
cd ../02-security
terraform init -backend-config=../../backend.hcl -backend-config=backend.config
terraform plan -var-file=terraform.tfvars
```

---

## ìš”ì•½

### í•µì‹¬ ê°œë… ì •ë¦¬
- âœ… **VPC**: ë‚˜ë§Œì˜ ë…ë¦½ëœ ë„¤íŠ¸ì›Œí¬ ê³µê°„ (10.0.0.0/16)
- âœ… **Public Subnet**: ì¸í„°ë„· ì§ì ‘ ì ‘ê·¼ ê°€ëŠ¥ (ALB ë°°ì¹˜)
- âœ… **Private App Subnet**: NAT Gateway ê²½ìœ  ì¸í„°ë„· ì ‘ê·¼ (ECS ë°°ì¹˜)
- âœ… **Private DB Subnet**: ì¸í„°ë„· ì ‘ê·¼ ë¶ˆê°€ (Aurora ë°°ì¹˜)
- âœ… **NAT Gateway**: Private â†’ ì¸í„°ë„· ë‹¨ë°©í–¥ í†µì‹ 
- âœ… **VPC Endpoint**: AWS ì„œë¹„ìŠ¤ í”„ë¼ì´ë¹— ì ‘ê·¼ (ë¹„ìš©/ì†ë„ ìµœì í™”)

### ìƒì„±ë˜ëŠ” ì£¼ìš” ë¦¬ì†ŒìŠ¤
- VPC 1ê°œ
- ì„œë¸Œë„· 6ê°œ (AZë³„ 3ì¢…ë¥˜)
- NAT Gateway 1ê°œ
- Internet Gateway 1ê°œ
- VPC ì—”ë“œí¬ì¸íŠ¸ 8ê°œ
- ë¼ìš°íŒ… í…Œì´ë¸” 4ê°œ

### ì˜ˆìƒ ë¹„ìš©
- **ì›” $85** (NAT Gateway + VPC Endpoints)
- ê°œë°œ í™˜ê²½: ë¯¸ì‚¬ìš© ì‹œ ì‚­ì œ ê¶Œì¥

---

**ì‘ì„±ì¼**: 2025-11-09  
**ì‘ì„±ì**: í™©ì˜í˜„ 
**ë²„ì „**: 1.0
