진단 결과가 ecr-diagnosis-20251019-152544.log 에 저장됩니다.

[0;34m=== AWS 계정 정보 ===[0m
계정 ID: 897722691159
리전: ap-southeast-2

[0;34m=== 1. ECS 태스크 실행 역할 확인 ===[0m
[0;32m✅ ecsTaskExecutionRole 역할이 존재합니다[0m
연결된 정책들:
---------------------------------------------------------------------------
|                        ListAttachedRolePolicies                         |
+-------------------------------------------------------------------------+
|  arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy  |
+-------------------------------------------------------------------------+

[0;34m=== 2. ECR 리포지토리 및 이미지 확인 ===[0m
[1;33m=== customers 서비스 ===[0m
[0;32m✅ 리포지토리 petclinic-dev-customers 존재[0m
이미지 목록:
-----------------------------------------------------------------------------------------------------------------------------------------------
|                                                               DescribeImages                                                                |
+----------------------------+---------------------------------------------------------------------------+------------------------------------+
|  develop-2025-10-19-13d9d55|  sha256:dacb983f1aa646836accd93d1ace42d6f44908bd5038a8bd2805053bacbb6ec9  |  2025-10-19T09:36:43.992000+09:00  |
+----------------------------+---------------------------------------------------------------------------+------------------------------------+
리포지토리 URI: 897722691159.dkr.ecr.ap-southeast-2.amazonaws.com/petclinic-dev-customers

[1;33m=== vets 서비스 ===[0m
[0;32m✅ 리포지토리 petclinic-dev-vets 존재[0m
이미지 목록:
-----------------------------------------------------------------------------------------------------------------------------------------------
|                                                               DescribeImages                                                                |
+----------------------------+---------------------------------------------------------------------------+------------------------------------+
|  develop-2025-10-19-13d9d55|  sha256:25cfce828b9e9767ce51b17c381d5611a8fb4937e538fa346688d1d9df73b864  |  2025-10-19T09:37:02.990000+09:00  |
+----------------------------+---------------------------------------------------------------------------+------------------------------------+
리포지토리 URI: 897722691159.dkr.ecr.ap-southeast-2.amazonaws.com/petclinic-dev-vets

[1;33m=== visits 서비스 ===[0m
[0;32m✅ 리포지토리 petclinic-dev-visits 존재[0m
이미지 목록:
-----------------------------------------------------------------------------------------------------------------------------------------------
|                                                               DescribeImages                                                                |
+----------------------------+---------------------------------------------------------------------------+------------------------------------+
|  develop-2025-10-19-13d9d55|  sha256:9a94f70756a819716f37514bb0f50c8006e7d577b91d593b2279ba8d98fe100a  |  2025-10-19T09:37:22.229000+09:00  |
+----------------------------+---------------------------------------------------------------------------+------------------------------------+
리포지토리 URI: 897722691159.dkr.ecr.ap-southeast-2.amazonaws.com/petclinic-dev-visits

[1;33m=== admin 서비스 ===[0m
[0;32m✅ 리포지토리 petclinic-dev-admin 존재[0m
이미지 목록:
-----------------------------------------------------------------------------------------------------------------------------------------------
|                                                               DescribeImages                                                                |
+----------------------------+---------------------------------------------------------------------------+------------------------------------+
|  develop-2025-10-19-13d9d55|  sha256:bab7909ec65a60c32c6e3dc5571b5595b9e15c562125056f39d1e63f91fd0394  |  2025-10-19T09:37:38.489000+09:00  |
+----------------------------+---------------------------------------------------------------------------+------------------------------------+
리포지토리 URI: 897722691159.dkr.ecr.ap-southeast-2.amazonaws.com/petclinic-dev-admin

[0;34m=== 3. VPC 및 네트워크 정보 확인 ===[0m
[0;32m✅ VPC 발견: vpc-0ee05210fb94a7bf3[0m
DNS Support: True
DNS Hostnames: True
[0;31m❌ VPC DNS 설정에 문제가 있습니다[0m

[0;34m=== 4. VPC 엔드포인트 확인 ===[0m
확인 중: com.amazonaws.ap-southeast-2.ecr.api
[0;31m❌ VPC 엔드포인트가 존재하지 않습니다: com.amazonaws.ap-southeast-2.ecr.api[0m

확인 중: com.amazonaws.ap-southeast-2.ecr.dkr
[0;31m❌ VPC 엔드포인트가 존재하지 않습니다: com.amazonaws.ap-southeast-2.ecr.dkr[0m

확인 중: com.amazonaws.ap-southeast-2.logs
[0;32m✅ VPC 엔드포인트 존재: vpce-02a46d4aff2fcb7aa[0m
상태: available
Private DNS 활성화: True
정책이 설정되어 있습니다 (상세 내용은 AWS 콘솔에서 확인)

[0;34m=== 5. 보안 그룹 확인 ===[0m
[0;32m✅ ECS 보안 그룹 발견: sg-0a1b0929227d79c1e[0m
[0;32m✅ HTTPS(443) 아웃바운드 규칙 존재[0m

[0;34m=== 6. 네트워크 ACL 확인 ===[0m
VPC vpc-0ee05210fb94a7bf3 의 네트워크 ACL 규칙 (443 포트 관련):
---------------------
|DescribeNetworkAcls|

[0;34m=== 7. ECS 태스크 정의 확인 ===[0m
확인 중: petclinic-dev-customers
[0;32m✅ 태스크 정의 존재: petclinic-dev-customers[0m
이미지 URI: 897722691159.dkr.ecr.ap-southeast-2.amazonaws.com/petclinic-dev-customers@sha256:dacb983f1aa646836accd93d1ace42d6f44908bd5038a8bd2805053bacbb6ec9
실행 역할: arn:aws:iam::897722691159:role/petclinic-ecs-task-execution-role

확인 중: petclinic-dev-vets
[0;32m✅ 태스크 정의 존재: petclinic-dev-vets[0m
이미지 URI: 897722691159.dkr.ecr.ap-southeast-2.amazonaws.com/petclinic-dev-vets@sha256:25cfce828b9e9767ce51b17c381d5611a8fb4937e538fa346688d1d9df73b864
실행 역할: arn:aws:iam::897722691159:role/petclinic-ecs-task-execution-role

확인 중: petclinic-dev-visits
[0;32m✅ 태스크 정의 존재: petclinic-dev-visits[0m
이미지 URI: 897722691159.dkr.ecr.ap-southeast-2.amazonaws.com/petclinic-dev-visits@sha256:9a94f70756a819716f37514bb0f50c8006e7d577b91d593b2279ba8d98fe100a
실행 역할: arn:aws:iam::897722691159:role/petclinic-ecs-task-execution-role

확인 중: petclinic-dev-admin
[0;32m✅ 태스크 정의 존재: petclinic-dev-admin[0m
이미지 URI: 897722691159.dkr.ecr.ap-southeast-2.amazonaws.com/petclinic-dev-admin@sha256:bab7909ec65a60c32c6e3dc5571b5595b9e15c562125056f39d1e63f91fd0394
실행 역할: arn:aws:iam::897722691159:role/petclinic-ecs-task-execution-role

[0;34m=== 8. ECR 로그인 테스트 ===[0m
ECR 로그인 토큰 획득 테스트...
[0;32m✅ ECR 로그인 토큰 획득 성공[0m

[0;34m=== 9. DNS 해석 테스트 ===[0m
DNS 해석 테스트: api.ecr.ap-southeast-2.amazonaws.com
[0;32m✅ DNS 해석 성공: api.ecr.ap-southeast-2.amazonaws.com[0m
DNS 해석 테스트: 897722691159.dkr.ecr.ap-southeast-2.amazonaws.com
[0;32m✅ DNS 해석 성공: 897722691159.dkr.ecr.ap-southeast-2.amazonaws.com[0m

[0;34m=== 진단 요약 및 권장사항 ===[0m

주요 확인 사항:
1. ECS 태스크 실행 역할 (ecsTaskExecutionRole) 존재 여부
2. ECR 리포지토리 및 이미지 존재 여부
3. VPC 엔드포인트 설정 및 상태
4. 보안 그룹 및 네트워크 ACL 규칙
5. ECS 태스크 정의의 이미지 URI 및 실행 역할

다음 단계:
- 위의 진단 결과를 바탕으로 문제점을 식별하세요
- 누락된 리소스나 잘못된 설정을 수정하세요
- 특히 ecsTaskExecutionRole과 ECR 이미지 존재 여부를 우선 확인하세요

==========================================
ECR 연결성 심화 진단 완료
진단 결과: ecr-diagnosis-20251019-152544.log
==========================================
