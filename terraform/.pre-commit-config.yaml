# Terraform Pre-commit Hooks 설정
# 이 파일은 Git commit 전에 자동으로 실행될 검증 도구들을 정의합니다.

repos:
  # Terraform 기본 hooks
  - repo: https://github.com/antonbabenko/pre-commit-terraform
    rev: v1.88.4
    hooks:
      # Terraform 포맷팅
      - id: terraform_fmt
        name: Terraform Format
        description: Terraform 코드 포맷팅 검사 및 자동 수정
        args:
          - --args=-recursive
          - --args=-diff

      # Terraform 검증
      - id: terraform_validate
        name: Terraform Validate
        description: Terraform 구문 및 설정 검증
        args:
          - --args=-json
        exclude: ^terraform/bootstrap-oregon/

      # TFLint 실행
      - id: terraform_tflint
        name: TFLint
        description: Terraform 코드 품질 및 모범 사례 검사
        args:
          - --args=--config=__GIT_WORKING_DIR__/.tflint.hcl
          - --args=--format=compact

      # Terraform 문서 생성
      - id: terraform_docs
        name: Terraform Docs
        description: Terraform 모듈 문서 자동 생성
        args:
          - --hook-config=--path-to-file=README.md
          - --hook-config=--add-to-existing-file=true
          - --hook-config=--create-file-if-not-exist=true

      # Terraform 보안 검사 (Checkov)
      - id: terraform_checkov
        name: Checkov Security Scan
        description: Terraform 보안 및 컴플라이언스 검사
        args:
          - --args=--config-file=__GIT_WORKING_DIR__/.checkov.yaml
          - --args=--framework=terraform
          - --args=--download-external-modules=true

  # 일반적인 파일 검사
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      # 파일 끝 개행 문자 확인
      - id: end-of-file-fixer
        name: Fix End of Files
        description: 파일 끝에 개행 문자가 있는지 확인하고 추가
        exclude: \.png$|\.jpg$|\.jpeg$|\.gif$|\.ico$

      # 후행 공백 제거
      - id: trailing-whitespace
        name: Trim Trailing Whitespace
        description: 줄 끝의 불필요한 공백 제거
        exclude: \.md$

      # 큰 파일 체크
      - id: check-added-large-files
        name: Check for Large Files
        description: 큰 파일이 추가되지 않았는지 확인
        args: ['--maxkb=1000']

      # JSON 구문 검사
      - id: check-json
        name: Check JSON
        description: JSON 파일 구문 검사

      # YAML 구문 검사
      - id: check-yaml
        name: Check YAML
        description: YAML 파일 구문 검사
        args: ['--allow-multiple-documents']

      # 병합 충돌 마커 확인
      - id: check-merge-conflict
        name: Check Merge Conflict
        description: Git 병합 충돌 마커가 남아있는지 확인

  # 추가 보안 검사
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.4.0
    hooks:
      - id: detect-secrets
        name: Detect Secrets
        description: 코드에 하드코딩된 비밀번호나 키가 있는지 검사
        args: ['--baseline', '.secrets.baseline']
        exclude: \.lock$|\.tfstate$|\.tfstate\.backup$

# Pre-commit 설정
default_stages: [commit]
fail_fast: false

# CI 환경에서의 설정
ci:
  autofix_commit_msg: |
    [pre-commit.ci] auto fixes from pre-commit hooks

    for more information, see https://pre-commit.ci
  autofix_prs: true
  autoupdate_branch: ''
  autoupdate_commit_msg: '[pre-commit.ci] pre-commit autoupdate'
  autoupdate_schedule: weekly
  skip: []
  submodules: false